<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1 Introducing SpaDES with a dummy ecological model | SpaDES 4 Dummies guide</title>
  <meta name="description" content="A SpaDES crash-course" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="1 Introducing SpaDES with a dummy ecological model | SpaDES 4 Dummies guide" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A SpaDES crash-course" />
  <meta name="github-repo" content="CeresBarros/SpaDES4Dummies" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1 Introducing SpaDES with a dummy ecological model | SpaDES 4 Dummies guide" />
  
  <meta name="twitter:description" content="A SpaDES crash-course" />
  

<meta name="author" content="Ceres Barros" />


<meta name="date" content="2023-08-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="part2.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/codefolding-lua-1.1/codefolding-lua.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="docs/index.html">SpaDES 4 Dummies</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="part1.html"><a href="part1.html"><i class="fa fa-check"></i><b>1</b> Introducing <code>SpaDES</code> with a dummy ecological model</a>
<ul>
<li class="chapter" data-level="1.1" data-path="part1.html"><a href="part1.html#before-spades"><i class="fa fa-check"></i><b>1.1</b> BEFORE <code>SpaDES</code>…</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="part1.html"><a href="part1.html#setup"><i class="fa fa-check"></i><b>1.1.1</b> Setup</a></li>
<li class="chapter" data-level="1.1.2" data-path="part1.html"><a href="part1.html#species-abundance-simulations"><i class="fa fa-check"></i><b>1.1.2</b> Species abundance “simulations”</a></li>
<li class="chapter" data-level="1.1.3" data-path="part1.html"><a href="part1.html#temperature-simulations"><i class="fa fa-check"></i><b>1.1.3</b> Temperature “simulations”</a></li>
<li class="chapter" data-level="1.1.4" data-path="part1.html"><a href="part1.html#data-analysis"><i class="fa fa-check"></i><b>1.1.4</b> Data analysis</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="part1.html"><a href="part1.html#after-spades"><i class="fa fa-check"></i><b>1.2</b> AFTER <code>SpaDES</code>…</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="part1.html"><a href="part1.html#the-control-script"><i class="fa fa-check"></i><b>1.2.1</b> The control script</a></li>
<li class="chapter" data-level="1.2.2" data-path="part1.html"><a href="part1.html#general-module-structure-speciesabundance-module"><i class="fa fa-check"></i><b>1.2.2</b> General module structure: <em>speciesAbundance</em> module</a></li>
<li class="chapter" data-level="1.2.3" data-path="part1.html"><a href="part1.html#creating-and-adding-additional-modules-the-temperature-module"><i class="fa fa-check"></i><b>1.2.3</b> Creating and adding additional modules: the <em>temperature</em> module</a></li>
<li class="chapter" data-level="1.2.4" data-path="part1.html"><a href="part1.html#modules-that-depend-on-other-modules-the-speciestemplm-module"><i class="fa fa-check"></i><b>1.2.4</b> Modules that depend on other modules: the <em>speciesTempLM</em> module</a></li>
<li class="chapter" data-level="1.2.5" data-path="part1.html"><a href="part1.html#simulation"><i class="fa fa-check"></i><b>1.2.5</b> Simulation</a></li>
<li class="chapter" data-level="1.2.6" data-path="part1.html"><a href="part1.html#additional-notes"><i class="fa fa-check"></i><b>1.2.6</b> Additional notes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="part2.html"><a href="part2.html"><i class="fa fa-check"></i><b>2</b> A more realistic example of <code>SpaDES</code></a>
<ul>
<li class="chapter" data-level="2.1" data-path="part2.html"><a href="part2.html#the-example-projecting-species-distribution-shifts-under-climate-change"><i class="fa fa-check"></i><b>2.1</b> The example: projecting species distribution shifts under climate change</a></li>
<li class="chapter" data-level="2.2" data-path="part2.html"><a href="part2.html#module-creation-and-coding"><i class="fa fa-check"></i><b>2.2</b> Module creation and coding</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="part2.html"><a href="part2.html#data-modules"><i class="fa fa-check"></i><b>2.2.1</b> Data modules</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="part2.html"><a href="part2.html#running-the-model"><i class="fa fa-check"></i><b>2.3</b> Running the model</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="part2.html"><a href="part2.html#ensuring-all-packages-are-installed"><i class="fa fa-check"></i><b>2.3.1</b> Ensuring all packages are installed</a></li>
<li class="chapter" data-level="2.3.2" data-path="part2.html"><a href="part2.html#simulation-set-up"><i class="fa fa-check"></i><b>2.3.2</b> Simulation set-up</a></li>
<li class="chapter" data-level="2.3.3" data-path="part2.html"><a href="part2.html#simulation-runs"><i class="fa fa-check"></i><b>2.3.3</b> Simulation runs</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="part2.html"><a href="part2.html#caching"><i class="fa fa-check"></i><b>2.4</b> Caching</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="part2.html"><a href="part2.html#explicitly-caching-operations"><i class="fa fa-check"></i><b>2.4.1</b> Explicitly caching operations</a></li>
<li class="chapter" data-level="2.4.2" data-path="part2.html"><a href="part2.html#implicit-caching-of-events"><i class="fa fa-check"></i><b>2.4.2</b> Implicit caching of events</a></li>
<li class="chapter" data-level="2.4.3" data-path="part2.html"><a href="part2.html#controlling-caching-without-changing-module-code"><i class="fa fa-check"></i><b>2.4.3</b> Controlling caching without changing module code</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="part2.html"><a href="part2.html#best-practices"><i class="fa fa-check"></i><b>2.5</b> Best practices</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="part2.html"><a href="part2.html#reproducible-package-installation"><i class="fa fa-check"></i><b>2.5.1</b> Reproducible package installation</a></li>
<li class="chapter" data-level="2.5.2" data-path="part2.html"><a href="part2.html#protect-yourself-and-others-from-common-mistakesproblems"><i class="fa fa-check"></i><b>2.5.2</b> Protect yourself and others from common mistakes/problems</a></li>
<li class="chapter" data-level="2.5.3" data-path="part2.html"><a href="part2.html#readable-code"><i class="fa fa-check"></i><b>2.5.3</b> Readable code</a></li>
<li class="chapter" data-level="2.5.4" data-path="part2.html"><a href="part2.html#module-documentation-module-.rmd"><i class="fa fa-check"></i><b>2.5.4</b> Module documentation – module <code>.Rmd</code></a></li>
<li class="chapter" data-level="2.5.5" data-path="part2.html"><a href="part2.html#coding-for-the-future"><i class="fa fa-check"></i><b>2.5.5</b> Coding for the future</a></li>
<li class="chapter" data-level="2.5.6" data-path="part2.html"><a href="part2.html#transparent-models"><i class="fa fa-check"></i><b>2.5.6</b> Transparent models</a></li>
<li class="chapter" data-level="2.5.7" data-path="part2.html"><a href="part2.html#additional-notes-1"><i class="fa fa-check"></i><b>2.5.7</b> Additional notes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">SpaDES 4 Dummies guide</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="part1" class="section level1 hasAnchor" number="1">
<h1><span class="header-section-number">1</span> Introducing <code>SpaDES</code> with a dummy ecological model<a href="part1.html#part1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Authors: Ceres Barros, Tati Micheletti</p>
<p>Let’s imagine we want to explore how the relationship between a species’ abundance and temperature changes over time.
Both the abundance data and the temperature data are being constantly updated by a simulation model, and we want to analyse the relationship between the two iteratively, without needing to manually run a script to account for the newly generated data inputs.</p>
<div id="before-spades" class="section level2 hasAnchor" number="1.1">
<h2><span class="header-section-number">1.1</span> BEFORE <code>SpaDES</code>…<a href="part1.html#before-spades" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>If we use R to develop our species abundance and temperature simulation models in the ‘conventional way’, we’ll probably have i) (the worst case scenario) several scripts that run simulations and data treatment/analysis separately and have to be executed manually, or ii) a long script where everything happens - the simulations and data analysis -, iii) a main script that sources others that do the simulation and analyses.
Option i) is more common when different software are used for different parts of the process (e.g., a simulation model in <em>C++</em> generates data that is then analysed in R).
Option ii) is inconvenient because very long scripts make changes and updates to the script - debugging can also be more tiresome.
Option iii), is similar to the <code>SpaDES</code> way of thinking.
The difference is that <code>SpaDES</code> defines a standard way of writing different components of a model, or of a modelling framework.
This makes changing, updating and sharing code - or modules - easier, as well as swapping and adding modules in a modelling framework.</p>
<p>The example below is so minimal that it is unlikely to show the full benefits of using <code>SpaDES</code> - the same could be accomplished with a fairly short script.
However, it introduces the different parts of a module and how to link modules.</p>
<p>Part <a href="part2.html#part2">2</a> goes a step further and uses real datasets to project species presences across a landscape in Canada.
In Part <a href="part2.html#part2">2</a>, we introduce <code>SpaDES</code> features that we most commonly use in our work (e.g., caching and spatial data processing) and provide some coding best practices that we use ourselves (e.g., code assertions).</p>
<div id="setup" class="section level3 hasAnchor" number="1.1.1">
<h3><span class="header-section-number">1.1.1</span> Setup<a href="part1.html#setup" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This is what you’d normally do… Install all the packages in some way that you probably didn’t record in your scripts and then start your script with loading the packages:</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb1"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb1-1"><a href="part1.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## please start from a clean R session</span></span>
<span id="cb1-2"><a href="part1.html#cb1-2" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;ropensci/NLMR&quot;</span>)  <span class="do">## you will need this ;)</span></span>
<span id="cb1-3"><a href="part1.html#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="part1.html#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb1-5"><a href="part1.html#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quickPlot)</span>
<span id="cb1-6"><a href="part1.html#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-7"><a href="part1.html#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SpaDES.tools)</span>
<span id="cb1-8"><a href="part1.html#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span></code></pre></div>
</details>
<p>And now create a raster template:</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb2"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb2-1"><a href="part1.html#cb2-1" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="at">nrows =</span> <span class="dv">100</span>, <span class="at">ncols =</span> <span class="dv">100</span>, <span class="at">xmn =</span> <span class="sc">-</span><span class="dv">50</span>, <span class="at">xmx =</span> <span class="dv">50</span>, <span class="at">ymn =</span> <span class="sc">-</span><span class="dv">50</span>, <span class="at">ymx =</span> <span class="dv">50</span>)</span></code></pre></div>
</details>
</div>
<div id="species-abundance-simulations" class="section level3 hasAnchor" number="1.1.2">
<h3><span class="header-section-number">1.1.2</span> Species abundance “simulations”<a href="part1.html#species-abundance-simulations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Our VERY simple “simulation” model (in form of a function) generates rasters that follow a Gaussian distribution</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb3"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb3-1"><a href="part1.html#cb3-1" aria-hidden="true" tabindex="-1"></a>abundance_model <span class="ot">&lt;-</span> <span class="cf">function</span>(ras, Time) {</span>
<span id="cb3-2"><a href="part1.html#cb3-2" aria-hidden="true" tabindex="-1"></a>  abund_outputs <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb3-3"><a href="part1.html#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>Time) { </span>
<span id="cb3-4"><a href="part1.html#cb3-4" aria-hidden="true" tabindex="-1"></a>    abund_outputs[[t]] <span class="ot">&lt;-</span> NLMR<span class="sc">::</span><span class="fu">nlm_mpd</span>(</span>
<span id="cb3-5"><a href="part1.html#cb3-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">ncol =</span> <span class="fu">ncol</span>(ras),</span>
<span id="cb3-6"><a href="part1.html#cb3-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">nrow =</span> <span class="fu">nrow</span>(ras),</span>
<span id="cb3-7"><a href="part1.html#cb3-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">resolution =</span> <span class="fu">unique</span>(<span class="fu">res</span>(ras)),</span>
<span id="cb3-8"><a href="part1.html#cb3-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">roughness =</span> <span class="fl">0.5</span>, </span>
<span id="cb3-9"><a href="part1.html#cb3-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">rand_dev =</span> <span class="dv">100</span>,</span>
<span id="cb3-10"><a href="part1.html#cb3-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">rescale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-11"><a href="part1.html#cb3-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb3-12"><a href="part1.html#cb3-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-13"><a href="part1.html#cb3-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-14"><a href="part1.html#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(abund_outputs)</span>
<span id="cb3-15"><a href="part1.html#cb3-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>Set the length of the simulation (or simply the number of model iterations), run it and plot results (all ABUNDANCE plots together):</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb4"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb4-1"><a href="part1.html#cb4-1" aria-hidden="true" tabindex="-1"></a>Time <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb4-2"><a href="part1.html#cb4-2" aria-hidden="true" tabindex="-1"></a>abundance <span class="ot">&lt;-</span> <span class="fu">abundance_model</span>(<span class="at">ras =</span> r, <span class="at">Time =</span> Time)</span>
<span id="cb4-3"><a href="part1.html#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dev</span>()</span>
<span id="cb4-4"><a href="part1.html#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">stack</span>(abundance))</span></code></pre></div>
</details>
<p><img src="Part1_DummyModel_files/figure-html/the_r_way_simulation_length-1.png" width="672" /></p>
</div>
<div id="temperature-simulations" class="section level3 hasAnchor" number="1.1.3">
<h3><span class="header-section-number">1.1.3</span> Temperature “simulations”<a href="part1.html#temperature-simulations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The temperature simulation model will be similar to the vegetation one - remember this is a dummy example.</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb5"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb5-1"><a href="part1.html#cb5-1" aria-hidden="true" tabindex="-1"></a>temperature_model <span class="ot">&lt;-</span> <span class="cf">function</span>(ras, Time) {</span>
<span id="cb5-2"><a href="part1.html#cb5-2" aria-hidden="true" tabindex="-1"></a>  temp_outputs <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb5-3"><a href="part1.html#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>Time) { </span>
<span id="cb5-4"><a href="part1.html#cb5-4" aria-hidden="true" tabindex="-1"></a>    temp_outputs[[t]] <span class="ot">&lt;-</span> NLMR<span class="sc">::</span><span class="fu">nlm_mpd</span>(</span>
<span id="cb5-5"><a href="part1.html#cb5-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">ncol =</span> <span class="fu">ncol</span>(ras),</span>
<span id="cb5-6"><a href="part1.html#cb5-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">nrow =</span> <span class="fu">nrow</span>(ras),</span>
<span id="cb5-7"><a href="part1.html#cb5-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">resolution =</span> <span class="fu">unique</span>(<span class="fu">res</span>(ras)),</span>
<span id="cb5-8"><a href="part1.html#cb5-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">roughness =</span> <span class="fl">0.5</span>,</span>
<span id="cb5-9"><a href="part1.html#cb5-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">rand_dev =</span> <span class="dv">10</span>,</span>
<span id="cb5-10"><a href="part1.html#cb5-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">rescale =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-11"><a href="part1.html#cb5-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb5-12"><a href="part1.html#cb5-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-13"><a href="part1.html#cb5-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-14"><a href="part1.html#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(temp_outputs)</span>
<span id="cb5-15"><a href="part1.html#cb5-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>Run the model and plot results (all temperature plots together)</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb6"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb6-1"><a href="part1.html#cb6-1" aria-hidden="true" tabindex="-1"></a>temperature <span class="ot">&lt;-</span> <span class="fu">temperature_model</span>(<span class="at">ras =</span> r, <span class="at">Time =</span> Time)</span>
<span id="cb6-2"><a href="part1.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">stack</span>(temperature))</span></code></pre></div>
</details>
<p><img src="Part1_DummyModel_files/figure-html/the_r_way_plot_results_TMP-1.png" width="672" /></p>
</div>
<div id="data-analysis" class="section level3 hasAnchor" number="1.1.4">
<h3><span class="header-section-number">1.1.4</span> Data analysis<a href="part1.html#data-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now we analyse if species abundance and temperature are correlated.<br />
</p>
<p>First, we create the data analysis function (a simple linear model):</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb7"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb7-1"><a href="part1.html#cb7-1" aria-hidden="true" tabindex="-1"></a>stats_analysis <span class="ot">&lt;-</span> <span class="cf">function</span>(Data) {</span>
<span id="cb7-2"><a href="part1.html#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">c</span>(<span class="st">&quot;abund&quot;</span>, <span class="st">&quot;temp&quot;</span>) <span class="sc">%in%</span> <span class="fu">colnames</span>(Data))) {</span>
<span id="cb7-3"><a href="part1.html#cb7-3" aria-hidden="true" tabindex="-1"></a>    lm1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(abund <span class="sc">~</span> temp, <span class="at">data =</span> Data)</span>
<span id="cb7-4"><a href="part1.html#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(Data) <span class="sc">+</span> </span>
<span id="cb7-5"><a href="part1.html#cb7-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> temp, <span class="at">y =</span> abund)) <span class="sc">+</span></span>
<span id="cb7-6"><a href="part1.html#cb7-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_abline</span>(<span class="at">intercept =</span> lm1<span class="sc">$</span>coefficients[<span class="st">&quot;(Intercept)&quot;</span>], </span>
<span id="cb7-7"><a href="part1.html#cb7-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">slope =</span> lm1<span class="sc">$</span>coefficients[<span class="st">&quot;temp&quot;</span>], <span class="at">size =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb7-8"><a href="part1.html#cb7-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb7-9"><a href="part1.html#cb7-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Temp.&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Species abundance&quot;</span>)</span>
<span id="cb7-10"><a href="part1.html#cb7-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-11"><a href="part1.html#cb7-11" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb7-12"><a href="part1.html#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;Data must contain &#39;abund&#39; and &#39;temp&#39; columns&quot;</span>)</span>
<span id="cb7-13"><a href="part1.html#cb7-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-14"><a href="part1.html#cb7-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>Then we create a loop to analyse each plot of our time-series:</p>
<details class=chunk-details open><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb8"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb8-1"><a href="part1.html#cb8-1" aria-hidden="true" tabindex="-1"></a>lmPlots <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb8-2"><a href="part1.html#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>Time) {</span>
<span id="cb8-3"><a href="part1.html#cb8-3" aria-hidden="true" tabindex="-1"></a>  outputdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">abund =</span> abundance[[t]][], <span class="at">temp =</span> temperature[[t]][])</span>
<span id="cb8-4"><a href="part1.html#cb8-4" aria-hidden="true" tabindex="-1"></a>  lmPlots[[t]] <span class="ot">&lt;-</span> <span class="fu">stats_analysis</span>(<span class="at">Data =</span> outputdata)</span>
<span id="cb8-5"><a href="part1.html#cb8-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-6"><a href="part1.html#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning: Using `size` aesthetic for lines was deprecated in ggplot2</span></span>
<span id="cb8-7"><a href="part1.html#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 3.4.0.</span></span>
<span id="cb8-8"><a href="part1.html#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="do">## ℹ Please use `linewidth` instead.</span></span>
<span id="cb8-9"><a href="part1.html#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="do">## This warning is displayed once every 8 hours.</span></span>
<span id="cb8-10"><a href="part1.html#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Call `lifecycle::last_lifecycle_warnings()` to see where</span></span>
<span id="cb8-11"><a href="part1.html#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="do">## this warning was generated.</span></span>
<span id="cb8-12"><a href="part1.html#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="at">plotlist =</span> lmPlots)</span></code></pre></div>
</details>
<p><img src="Part1_DummyModel_files/figure-html/data_analysis-1.png" width="672" /></p>
</div>
</div>
<div id="after-spades" class="section level2 hasAnchor" number="1.2">
<h2><span class="header-section-number">1.2</span> AFTER <code>SpaDES</code>…<a href="part1.html#after-spades" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="the-control-script" class="section level3 hasAnchor" number="1.2.1">
<h3><span class="header-section-number">1.2.1</span> The control script<a href="part1.html#the-control-script" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let us now solve the same problem using the <code>SpaDES</code> approach.
We start by creating an <em>.R</em> script (it can have any name) that sets up and runs the <code>SpaDES</code> model.
The control script for this example is located on the root of the <em>SpaDES4Dummies</em> GitHub repository under the name <code>Part1_DummyModel.R</code>.
Note that Markdown (<code>.Rmd</code>) scripts can also be used instead of `.R` scripts.</p>
<p>We start by making sure all <code>SpaDES</code> packages and their dependencies are installed (and that the installation is <em>scripted</em>) using the <code>Require</code> package.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="part1.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">## start again from a clean R session</span></span>
<span id="cb9-2"><a href="part1.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">repos =</span> <span class="fu">c</span>(<span class="st">&quot;https://predictiveecology.r-universe.dev/&quot;</span>, </span>
<span id="cb9-3"><a href="part1.html#cb9-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">CRAN =</span> <span class="st">&quot;https://cloud.r-project.org&quot;</span>))</span>
<span id="cb9-4"><a href="part1.html#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="part1.html#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="do">## decide where you&#39;re working</span></span>
<span id="cb9-6"><a href="part1.html#cb9-6" aria-hidden="true" tabindex="-1"></a>mainPath <span class="ot">&lt;-</span> <span class="st">&quot;~/SpaDES4Dummies_Part1&quot;</span></span>
<span id="cb9-7"><a href="part1.html#cb9-7" aria-hidden="true" tabindex="-1"></a>pkgPath <span class="ot">&lt;-</span> <span class="fu">file.path</span>(mainPath, <span class="st">&quot;packages&quot;</span>, version<span class="sc">$</span>platform,</span>
<span id="cb9-8"><a href="part1.html#cb9-8" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">paste0</span>(version<span class="sc">$</span>major, <span class="st">&quot;.&quot;</span>, <span class="fu">strsplit</span>(version<span class="sc">$</span>minor, <span class="st">&quot;[.]&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>]))</span>
<span id="cb9-9"><a href="part1.html#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(pkgPath, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-10"><a href="part1.html#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="fu">.libPaths</span>(pkgPath, <span class="at">include.site =</span> <span class="cn">FALSE</span>) <span class="do">## install packages in project library (proj-lib)</span></span>
<span id="cb9-11"><a href="part1.html#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="part1.html#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="st">&quot;remotes&quot;</span> <span class="sc">%in%</span> <span class="fu">installed.packages</span>(<span class="at">lib.loc =</span> pkgPath))</span>
<span id="cb9-13"><a href="part1.html#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">&quot;remotes&quot;</span>)</span>
<span id="cb9-14"><a href="part1.html#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="part1.html#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="st">&quot;Require&quot;</span> <span class="sc">%in%</span> <span class="fu">installed.packages</span>(<span class="at">lib.loc =</span> pkgPath) <span class="sc">||</span></span>
<span id="cb9-16"><a href="part1.html#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">packageVersion</span>(<span class="st">&quot;Require&quot;</span>, <span class="at">lib.loc =</span> pkgPath) <span class="sc">&lt;</span> <span class="st">&quot;0.3.1&quot;</span>) {</span>
<span id="cb9-17"><a href="part1.html#cb9-17" aria-hidden="true" tabindex="-1"></a>  remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;PredictiveEcology/Require@55ec169e654214d86be62a0e13e9a2157f1aa966&quot;</span>,</span>
<span id="cb9-18"><a href="part1.html#cb9-18" aria-hidden="true" tabindex="-1"></a>                          <span class="at">upgrade =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-19"><a href="part1.html#cb9-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-20"><a href="part1.html#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="part1.html#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="do">## use binary linux packages if on Ubuntu</span></span>
<span id="cb9-22"><a href="part1.html#cb9-22" aria-hidden="true" tabindex="-1"></a>Require<span class="sc">::</span><span class="fu">setLinuxBinaryRepo</span>()</span>
<span id="cb9-23"><a href="part1.html#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="part1.html#cb9-24" aria-hidden="true" tabindex="-1"></a>Require<span class="sc">::</span><span class="fu">Require</span>(<span class="fu">c</span>(<span class="st">&quot;SpaDES&quot;</span>, <span class="st">&quot;DiagrammeR&quot;</span>), <span class="at">require =</span> <span class="cn">FALSE</span>, <span class="at">upgrade =</span> <span class="cn">FALSE</span>, </span>
<span id="cb9-25"><a href="part1.html#cb9-25" aria-hidden="true" tabindex="-1"></a>                 <span class="at">dependencies =</span> <span class="cn">TRUE</span>, <span class="at">standAlone =</span> <span class="cn">TRUE</span>) <span class="do">## automatically downloads all packages in the SpaDES family and their dependencies</span></span>
<span id="cb9-26"><a href="part1.html#cb9-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-27"><a href="part1.html#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SpaDES)</span>
<span id="cb9-28"><a href="part1.html#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="part1.html#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="fu">setPaths</span>(<span class="at">cachePath =</span> <span class="fu">file.path</span>(mainPath, <span class="st">&quot;cache&quot;</span>),</span>
<span id="cb9-30"><a href="part1.html#cb9-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">inputPath =</span> <span class="fu">file.path</span>(mainPath, <span class="st">&quot;inputs&quot;</span>),</span>
<span id="cb9-31"><a href="part1.html#cb9-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">modulePath =</span> <span class="fu">file.path</span>(mainPath, <span class="st">&quot;modules&quot;</span>),</span>
<span id="cb9-32"><a href="part1.html#cb9-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">outputPath =</span> <span class="fu">file.path</span>(mainPath, <span class="st">&quot;outputs&quot;</span>))</span>
<span id="cb9-33"><a href="part1.html#cb9-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-34"><a href="part1.html#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="fu">getPaths</span>() <span class="do">## check that this is what you wanted</span></span>
<span id="cb9-35"><a href="part1.html#cb9-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-36"><a href="part1.html#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="do">## Let&#39;s create a self-contained module that will simulate the species&#39; abundance for any given period of time and frequency.</span></span>
<span id="cb9-37"><a href="part1.html#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">file.path</span>(<span class="fu">getPaths</span>()<span class="sc">$</span>modulePath, <span class="st">&quot;speciesAbundance&quot;</span>))) {</span>
<span id="cb9-38"><a href="part1.html#cb9-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">newModule</span>(<span class="at">name =</span> <span class="st">&quot;speciesAbundance&quot;</span>, <span class="at">path =</span> <span class="fu">getPaths</span>()<span class="sc">$</span>modulePath)</span>
<span id="cb9-39"><a href="part1.html#cb9-39" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>We then create modules using <code>newModule</code>.
<code>newModule</code> creates a module folder (<em>speciesAbundance</em>) inside <code>/modules</code> that contains both the module <code>.R</code> script template, as well as the documentation template (the <code>.Rmd</code> file).
Although we will not be discussing the <code>.Rmd</code> file, please bear in mind that this is a <strong>fundamental</strong> part of creating a reproducible and transparent module - check out the <a href="https://www.britishecologicalsociety.org/wp-content/uploads/2017/12/guide-to-reproducible-code.pdf">Guide to Reproducible Code in Ecology and Evolution</a> from the British Ecological Society).
The documentation should contain a the description of the module, its input, parameters and outputs, and potentially a reproducible examples of how the module is executed.</p>
<p><code>newModule</code> also created the folder <code>/data</code> where data necessary to the module can be put in, and the folder <code>/tests</code> that may contain testing scripts.
We will not be using either of them in this example.</p>
<p><strong>/!\ ATTENTION /!\</strong></p>
<p><em><code>newModule</code> should only be run once, otherwise it will replace all edits and contents of the module folder with the templates - this is why it is wrapped in an <code>if</code> statement above.</em></p>
<p>Now go ahead, open the <code>speciesAbundance.R</code> script and have a look at it.</p>
<hr />
</div>
<div id="general-module-structure-speciesabundance-module" class="section level3 hasAnchor" number="1.2.2">
<h3><span class="header-section-number">1.2.2</span> General module structure: <em>speciesAbundance</em> module<a href="part1.html#general-module-structure-speciesabundance-module" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The module template contains all the essential components of a module, with examples, and may seem overwhelming at first.
We’ll go through it step by step (although not necessarily following the order of the script).
The module script can be divided into 4 parts:</p>
<p><a href="part1.html#defining-the-module"><strong>Defining the module</strong></a>: this is where the module is <strong>defined</strong>, i.e., the module’s metadata (e.g. module author(s), time units, basic parameters, general inputs and outputs, etc.);</p>
<p><a href="part1.html#events-and-event-functions"><strong>Events and event functions</strong></a>: these are the “actions” (or events) executed in the module (i.e. species reproduction, plotting, saving parameters) - simply put, <strong>WHAT</strong> the module does;</p>
<p><a href="part1.html#scheduling-events"><strong>Scheduling events</strong></a>: this is how <code>SpaDES</code> schedules when each event is going to happen - in which order (e.g. during the simulation, when will <code>SpaDES</code> plot a graph) - simply put, <strong>WHEN</strong> the module does it;</p>
<p><a href="part1.html#additional-module-functions"><strong>Additional module functions</strong></a>: any additional functions needed (e.g. this is used to keep the coding of your module as clear and straightforward as possible);</p>
<p>The first thing to note is that <strong>the user does not need to manually run</strong> any of the code inside a module’s <code>.R</code> script.
The function <code>simInit()</code> will do so when it sets up the simulation.
We will see this see this later in detail.</p>
<div id="defining-the-module" class="section level4 hasAnchor" number="1.2.2.1">
<h4><span class="header-section-number">1.2.2.1</span> <strong>Defining the module</strong><a href="part1.html#defining-the-module" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The first section of the script defines the module’s <a href="https://data-informed.com/what-is-metadata-a-simple-guide-to-what-everyone-should-know/">metadata</a>.
It allows defining the module’s author, keywords, any required packages and module(s) and their versions, but also parameters (and their default values) and input objects that the module requires, and the output objects it creates.</p>
<p>Although this dummy module example requires no true input data, we will define the template raster `r` as an “input” in the <code>expectsInput</code> function, and provide a default object in <code>.inputObjects</code> (see below).
As for the outputs, it produces a list of abundance rasters (produced during the <code>abundanceSim</code> event).
So we define it as an output in the<code>createsOutput</code> function.</p>
<p>Note that we removed several parameters that come with the template created by the <code>newModule</code> function, as they are not needed for this example.</p>
<p>To distinguish what input and output objects are in the context of a module, a good rule of thumb is that inputs are all the <code>sim$...</code> objects that appear for the first time (in the module events) on the <strong>right-hand side</strong> of a <code>&lt;-</code>, whereas output parameters are the <code>sim$...</code> objects that appear for the first time to the <strong>left-hand side</strong> of a <code>&lt;-</code>.
Another way of explaining it for objects is illustrated in Fig.
<a href="part1.html#fig:figObj">1.1</a>:</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:figObj"></span>
<img src="figures/obj.png" alt="Inputs and outputs in SpaDES: Object A comes from outside of the module (e.g. from an internet URL, from data you have, or from `.inputObjects`), while Module Z produces object C. Both objects serve as an inputs for Module Y, which in return produce as outputs objects B and D, respectivelly from objects A and C. As Module Z uses a simple function *internally* to create object C, it doesn't have any inputs, such as our dummy example." width="80%" />
<p class="caption">
Figure 1.1: Inputs and outputs in SpaDES: Object A comes from outside of the module (e.g. from an internet URL, from data you have, or from <code>.inputObjects</code>), while Module Z produces object C. Both objects serve as an inputs for Module Y, which in return produce as outputs objects B and D, respectivelly from objects A and C. As Module Z uses a simple function <em>internally</em> to create object C, it doesn’t have any inputs, such as our dummy example.
</p>
</div>
<p>The default input objects created by the <code>.inputObjects</code> function (see [.inputObjects function]) during the <code>simInit</code> call are exceptions to this rule.</p>
<p>Here is how we defined the <em>speciesAbundance</em> module:</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="part1.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">defineModule</span>(sim, <span class="fu">list</span>(</span>
<span id="cb10-2"><a href="part1.html#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">&quot;speciesAbundance&quot;</span>,</span>
<span id="cb10-3"><a href="part1.html#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">description =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb10-4"><a href="part1.html#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">keywords =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb10-5"><a href="part1.html#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">authors =</span> <span class="fu">person</span>(<span class="st">&quot;Me&quot;</span>, <span class="at">email =</span> <span class="st">&quot;me@example.com&quot;</span>, <span class="at">role =</span> <span class="fu">c</span>(<span class="st">&quot;aut&quot;</span>, <span class="st">&quot;cre&quot;</span>)),</span>
<span id="cb10-6"><a href="part1.html#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">childModules =</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb10-7"><a href="part1.html#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">version =</span> <span class="fu">list</span>(<span class="at">speciesAbundanceData =</span> <span class="st">&quot;1.0.0&quot;</span>),</span>
<span id="cb10-8"><a href="part1.html#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">timeframe =</span> <span class="fu">as.POSIXlt</span>(<span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>)),</span>
<span id="cb10-9"><a href="part1.html#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">timeunit =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb10-10"><a href="part1.html#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">citation =</span> <span class="fu">list</span>(<span class="st">&quot;citation.bib&quot;</span>),</span>
<span id="cb10-11"><a href="part1.html#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">documentation =</span> <span class="fu">deparse</span>(<span class="fu">list</span>(<span class="st">&quot;README.txt&quot;</span>, <span class="st">&quot;speciesAbundance.Rmd&quot;</span>)),</span>
<span id="cb10-12"><a href="part1.html#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">reqdPkgs =</span> <span class="fu">list</span>(<span class="st">&quot;SpaDES.core (&gt;=2.0.2)&quot;</span>,</span>
<span id="cb10-13"><a href="part1.html#cb10-13" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;raster&quot;</span>, <span class="st">&quot;quickPlot&quot;</span>),</span>
<span id="cb10-14"><a href="part1.html#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">parameters =</span> <span class="fu">bindrows</span>(</span>
<span id="cb10-15"><a href="part1.html#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">#defineParameter(&quot;paramName&quot;, &quot;paramClass&quot;, value, min, max, &quot;parameter description&quot;),</span></span>
<span id="cb10-16"><a href="part1.html#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">defineParameter</span>(<span class="st">&quot;simulationTimeStep&quot;</span>, <span class="st">&quot;numeric&quot;</span>, <span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, </span>
<span id="cb10-17"><a href="part1.html#cb10-17" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;This describes the simulation time step interval&quot;</span>),</span>
<span id="cb10-18"><a href="part1.html#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">defineParameter</span>(<span class="st">&quot;.plotInitialTime&quot;</span>, <span class="st">&quot;numeric&quot;</span>, <span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>,</span>
<span id="cb10-19"><a href="part1.html#cb10-19" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;Describes the simulation time at which the first plot event should occur.&quot;</span>),</span>
<span id="cb10-20"><a href="part1.html#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">defineParameter</span>(<span class="st">&quot;.plotInterval&quot;</span>, <span class="st">&quot;numeric&quot;</span>, <span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>,</span>
<span id="cb10-21"><a href="part1.html#cb10-21" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;Describes the simulation time interval between plot events.&quot;</span>)</span>
<span id="cb10-22"><a href="part1.html#cb10-22" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb10-23"><a href="part1.html#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">inputObjects =</span> <span class="fu">bindrows</span>(</span>
<span id="cb10-24"><a href="part1.html#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># expectsInput(&quot;objectName&quot;, &quot;objectClass&quot;, &quot;input object description&quot;, sourceURL, ...),</span></span>
<span id="cb10-25"><a href="part1.html#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expectsInput</span>(<span class="st">&quot;r&quot;</span>, <span class="at">objectClass =</span> <span class="st">&quot;RasterLayer&quot;</span>, <span class="at">desc =</span> <span class="st">&quot;Template raster&quot;</span>)</span>
<span id="cb10-26"><a href="part1.html#cb10-26" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb10-27"><a href="part1.html#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">outputObjects =</span> <span class="fu">bindrows</span>(</span>
<span id="cb10-28"><a href="part1.html#cb10-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">#createsOutput(&quot;objectName&quot;, &quot;objectClass&quot;, &quot;output object description&quot;, ...),</span></span>
<span id="cb10-29"><a href="part1.html#cb10-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">createsOutput</span>(<span class="st">&quot;abundRasters&quot;</span>, <span class="st">&quot;list&quot;</span>, <span class="st">&quot;List of layers of species abundance at any given year&quot;</span>)</span>
<span id="cb10-30"><a href="part1.html#cb10-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-31"><a href="part1.html#cb10-31" aria-hidden="true" tabindex="-1"></a>))</span></code></pre></div>
</details>
<p>Note that the package versions that you define will depend on the ones that are installed on your computer.
So take care to change them accordingly.
The <code>SpaDES</code> package version suggested by the template reflects the version on your computer.</p>
<p>The rest of the script defines the events and their sequences for this module - remember <code>SpaDES</code> = Spatial Discrete Event Simulator - and the events themselves.</p>
<p><strong>/!\ ATTENTION /!\</strong></p>
<p><em><code>defineModule()</code> is not intended to be run directly by the user – it is run internally during a <code>simInit()</code> call (see <a href="part1.html#simulation-setup-in-a-global-script">Simulation setup in a “global” script</a>). In other words, you don’t run any part of a module’s code directly in your session; you run <code>simInit()</code> with that module listed in the modules argument.</em></p>
</div>
<div id="events-and-event-functions" class="section level4 hasAnchor" number="1.2.2.2">
<h4><span class="header-section-number">1.2.2.2</span> <strong>Events and event functions</strong><a href="part1.html#events-and-event-functions" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Module events are defined and scheduled in the <code>doEvent.&lt;module name&gt;</code> function (in this example, <code>doEvent.speciesAbundance</code> function; see [Scheduling events]. Since we are only interested in simulating and plotting species abundances, we removed unnecessary events from the script and kept: the initialisation (<code>init</code>), an abundance simulation event (<code>SimulAbund</code>) and a plotting event (<code>abundPlot</code>).
Each of these events can execute one or more functions.</p>
<p><em>Event functions</em> (actual R functions) mustn’t be confused with <em>event names</em>, which are the names of the events appearing in the <code>doEvent.&lt;module name&gt;</code>.</p>
<p><strong>/!\ ATTENTION /!\</strong></p>
<p><em>Event functions take only one argument, <code>sim</code> (the <code>SpaDES.core::simList</code> object that stores all objects, modules, functions, etc., of a simulation; see <code>?simList</code>) and event functions always (and only) return <code>sim</code> (using <code>return(invisible(sim))</code>).</em></p>
<div id="initialisation-event-function" class="section level5 hasAnchor" number="1.2.2.2.1">
<h5><span class="header-section-number">1.2.2.2.1</span> <em>Initialisation event function</em><a href="part1.html#initialisation-event-function" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The initialisation event function (here, <code>abundanceInit</code>) can be seen as the starting point of the module.
Unlike the <code>init</code> event, which must always be present, the function itself does not need to exist (see [Scheduling events]) and can have whatever name we want.</p>
<p>Usually, this function will does pre-simulation steps that are only need to be executed once.
In our dummy example, it creates a template raster and a storage list for our species abundance outputs (which will also be rasters).
Notice that the only argument to <code>abundanceInit</code> is <code>sim</code>, a <code>simList</code> object that is also its only output.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="part1.html#cb11-1" aria-hidden="true" tabindex="-1"></a>abundanceInit <span class="ot">&lt;-</span> <span class="cf">function</span>(sim) {</span>
<span id="cb11-2"><a href="part1.html#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">## create storage list of species abundance</span></span>
<span id="cb11-3"><a href="part1.html#cb11-3" aria-hidden="true" tabindex="-1"></a>  sim<span class="sc">$</span>abundRasters <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb11-4"><a href="part1.html#cb11-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-5"><a href="part1.html#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">invisible</span>(sim))</span>
<span id="cb11-6"><a href="part1.html#cb11-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
</div>
<div id="abundance-simulation-event-function" class="section level5 hasAnchor" number="1.2.2.2.2">
<h5><span class="header-section-number">1.2.2.2.2</span> <em>Abundance simulation event function</em><a href="part1.html#abundance-simulation-event-function" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The function <code>abundanceSim</code> is the core event function of this module, where species abundances are generated via the event.
Notice how instead of a <em>for-loop</em>, <code>abundanceSim</code> runs the <code>abundance_model</code> function (which we define separately below) and stores its outputs in the <code>sim$abundRaster</code> object.
Notice as well that we use <code>time(sim)</code> as the identifier of the list slots where outputs are stored (see <code>?SpaDES.core::time</code>).</p>
<p>As before, the sole argument and output to this event function is the <code>sim</code> object.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="part1.html#cb12-1" aria-hidden="true" tabindex="-1"></a>abundanceSim <span class="ot">&lt;-</span> <span class="cf">function</span>(sim) {</span>
<span id="cb12-2"><a href="part1.html#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Generate species abundances - our &quot;simulation&quot;</span></span>
<span id="cb12-3"><a href="part1.html#cb12-3" aria-hidden="true" tabindex="-1"></a>  sim<span class="sc">$</span>abundRasters[[<span class="fu">as.character</span>(<span class="fu">time</span>(sim))]] <span class="ot">&lt;-</span> <span class="fu">abundance_model</span>(<span class="at">ras =</span> sim<span class="sc">$</span>r)</span>
<span id="cb12-4"><a href="part1.html#cb12-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-5"><a href="part1.html#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">invisible</span>(sim))</span>
<span id="cb12-6"><a href="part1.html#cb12-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>The <code>abundanceSim</code> function was called <code>Event1</code> in the template.</p>
</div>
<div id="plotting-event-function" class="section level5 hasAnchor" number="1.2.2.2.3">
<h5><span class="header-section-number">1.2.2.2.3</span> <em>Plotting event function</em><a href="part1.html#plotting-event-function" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Finally, we created the <code>abundancePlot</code> event function to plot the species abundance rasters that are produced by the <code>abundanceSim</code> event function.
Again, the sole argument and output of this function is <code>sim</code>.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="part1.html#cb13-1" aria-hidden="true" tabindex="-1"></a>abundancePlot <span class="ot">&lt;-</span> <span class="cf">function</span>(sim) {</span>
<span id="cb13-2"><a href="part1.html#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">## plot abundances</span></span>
<span id="cb13-3"><a href="part1.html#cb13-3" aria-hidden="true" tabindex="-1"></a>  plotTitle <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;Species abundance</span><span class="sc">\n</span><span class="st">at time&quot;</span>,</span>
<span id="cb13-4"><a href="part1.html#cb13-4" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">names</span>(sim<span class="sc">$</span>abundRasters)[<span class="fu">length</span>(sim<span class="sc">$</span>abundRasters)])</span>
<span id="cb13-5"><a href="part1.html#cb13-5" aria-hidden="true" tabindex="-1"></a>  abundPlot <span class="ot">&lt;-</span> sim<span class="sc">$</span>abundRasters[[<span class="fu">length</span>(sim<span class="sc">$</span>abundRasters)]] </span>
<span id="cb13-6"><a href="part1.html#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Plot</span>(abundPlot, </span>
<span id="cb13-7"><a href="part1.html#cb13-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> plotTitle, </span>
<span id="cb13-8"><a href="part1.html#cb13-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">new =</span> <span class="cn">TRUE</span>, <span class="at">addTo =</span> <span class="st">&quot;abundPlot&quot;</span>)</span>
<span id="cb13-9"><a href="part1.html#cb13-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-10"><a href="part1.html#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">invisible</span>(sim))</span>
<span id="cb13-11"><a href="part1.html#cb13-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>The <code>abundancePlot</code> function was called <code>plotFun</code> in the template.</p>
</div>
</div>
<div id="scheduling-events" class="section level4 hasAnchor" number="1.2.2.3">
<h4><span class="header-section-number">1.2.2.3</span> <strong>Scheduling events</strong><a href="part1.html#scheduling-events" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The order in which module events are executed is determined by the <code>doEvent.&lt;module name&gt;</code> function.
This function also defines the events themselves and what happens in them.
The <code>switch</code> function executes each event (here <code>init</code>, <code>SimulAbund</code>, and <code>abundPlot</code>) and the events schedule themselves.
Two things are of particular importance:</p>
<ol style="list-style-type: decimal">
<li>The <code>init</code> event is <strong>mandatory</strong>. This is the only event whose <em>name</em> that cannot be changed and that cannot be removed (even if it does not execute any event functions). All other <code>events</code> are optional and can be renamed. <code>SpaDES</code> searches and executes all modules’ <code>init</code> events automatically. Note that the names of event functions executed during <code>init</code> <em>can</em> have any name: here we changed the <code>Init</code> function name (suggested by the template) to <code>abundanceInit</code>.</li>
<li><strong>Events should only schedule themselves</strong>. The only exception is the <code>init</code>, which schedules the first time all other events are executed (even if a particular event only occurs once at the end of the simulation).</li>
</ol>
<p>It is usually easier to fill the <code>doEvent.&lt;module name&gt;</code> function <em>after</em> having defined the event functions (as we did above).
For instance, we know that plotting should occur after the generation of species abundances, and so the <code>abundPlot</code> will be scheduled to occur after the <code>SimulAbund</code> event, by changing event priority (see <code>?priority</code>).</p>
<p>This is how we configured our <code>doEvent.speciesAbundance</code> function:</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="part1.html#cb14-1" aria-hidden="true" tabindex="-1"></a>doEvent.speciesAbundance <span class="ot">=</span> <span class="cf">function</span>(sim, eventTime, eventType, <span class="at">debug =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb14-2"><a href="part1.html#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">switch</span>(</span>
<span id="cb14-3"><a href="part1.html#cb14-3" aria-hidden="true" tabindex="-1"></a>    eventType,</span>
<span id="cb14-4"><a href="part1.html#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">init =</span> {</span>
<span id="cb14-5"><a href="part1.html#cb14-5" aria-hidden="true" tabindex="-1"></a>      <span class="do">## do stuff for this event</span></span>
<span id="cb14-6"><a href="part1.html#cb14-6" aria-hidden="true" tabindex="-1"></a>      sim <span class="ot">&lt;-</span> <span class="fu">abundanceInit</span>(sim)</span>
<span id="cb14-7"><a href="part1.html#cb14-7" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb14-8"><a href="part1.html#cb14-8" aria-hidden="true" tabindex="-1"></a>      <span class="do">## schedule future event(s)</span></span>
<span id="cb14-9"><a href="part1.html#cb14-9" aria-hidden="true" tabindex="-1"></a>      sim <span class="ot">&lt;-</span> <span class="fu">scheduleEvent</span>(sim, <span class="at">eventTime =</span> <span class="fu">start</span>(sim), <span class="at">moduleName =</span> <span class="st">&quot;speciesAbundance&quot;</span>, </span>
<span id="cb14-10"><a href="part1.html#cb14-10" aria-hidden="true" tabindex="-1"></a>                           <span class="at">eventType =</span> <span class="st">&quot;SimulAbund&quot;</span>)</span>
<span id="cb14-11"><a href="part1.html#cb14-11" aria-hidden="true" tabindex="-1"></a>      sim <span class="ot">&lt;-</span> <span class="fu">scheduleEvent</span>(sim, <span class="at">eventTime =</span> <span class="fu">P</span>(sim)<span class="sc">$</span>.plotInitialTime, </span>
<span id="cb14-12"><a href="part1.html#cb14-12" aria-hidden="true" tabindex="-1"></a>                           <span class="at">moduleName =</span> <span class="st">&quot;speciesAbundance&quot;</span>, <span class="at">eventType =</span> <span class="st">&quot;abundPlot&quot;</span>,</span>
<span id="cb14-13"><a href="part1.html#cb14-13" aria-hidden="true" tabindex="-1"></a>                           <span class="at">eventPriority =</span> <span class="fu">.normal</span>()<span class="sc">+</span><span class="fl">0.5</span>)</span>
<span id="cb14-14"><a href="part1.html#cb14-14" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb14-15"><a href="part1.html#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">SimulAbund =</span> {</span>
<span id="cb14-16"><a href="part1.html#cb14-16" aria-hidden="true" tabindex="-1"></a>      <span class="do">## do stuff for this event</span></span>
<span id="cb14-17"><a href="part1.html#cb14-17" aria-hidden="true" tabindex="-1"></a>      sim <span class="ot">&lt;-</span> <span class="fu">abundanceSim</span>(sim)</span>
<span id="cb14-18"><a href="part1.html#cb14-18" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb14-19"><a href="part1.html#cb14-19" aria-hidden="true" tabindex="-1"></a>      <span class="do">## schedule future event(s)</span></span>
<span id="cb14-20"><a href="part1.html#cb14-20" aria-hidden="true" tabindex="-1"></a>      sim <span class="ot">&lt;-</span> <span class="fu">scheduleEvent</span>(sim, <span class="at">eventTime =</span> <span class="fu">time</span>(sim) <span class="sc">+</span> <span class="fu">P</span>(sim)<span class="sc">$</span>simulationTimeStep, </span>
<span id="cb14-21"><a href="part1.html#cb14-21" aria-hidden="true" tabindex="-1"></a>                           <span class="at">moduleName =</span> <span class="st">&quot;speciesAbundance&quot;</span>, <span class="at">eventType =</span> <span class="st">&quot;SimulAbund&quot;</span>)</span>
<span id="cb14-22"><a href="part1.html#cb14-22" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb14-23"><a href="part1.html#cb14-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">abundPlot =</span> {</span>
<span id="cb14-24"><a href="part1.html#cb14-24" aria-hidden="true" tabindex="-1"></a>      <span class="do">## do stuff for this event</span></span>
<span id="cb14-25"><a href="part1.html#cb14-25" aria-hidden="true" tabindex="-1"></a>      sim <span class="ot">&lt;-</span> <span class="fu">abundancePlot</span>(sim)</span>
<span id="cb14-26"><a href="part1.html#cb14-26" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb14-27"><a href="part1.html#cb14-27" aria-hidden="true" tabindex="-1"></a>      <span class="do">## schedule future event(s)</span></span>
<span id="cb14-28"><a href="part1.html#cb14-28" aria-hidden="true" tabindex="-1"></a>      sim <span class="ot">&lt;-</span> <span class="fu">scheduleEvent</span>(sim, <span class="at">eventTime =</span> <span class="fu">time</span>(sim) <span class="sc">+</span> <span class="fu">P</span>(sim)<span class="sc">$</span>.plotInterval, </span>
<span id="cb14-29"><a href="part1.html#cb14-29" aria-hidden="true" tabindex="-1"></a>                           <span class="at">moduleName =</span> <span class="st">&quot;speciesAbundance&quot;</span>, <span class="at">eventType =</span> <span class="st">&quot;abundPlot&quot;</span>, </span>
<span id="cb14-30"><a href="part1.html#cb14-30" aria-hidden="true" tabindex="-1"></a>                           <span class="at">eventPriority =</span> <span class="fu">.normal</span>()<span class="sc">+</span><span class="fl">0.5</span>)</span>
<span id="cb14-31"><a href="part1.html#cb14-31" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb14-32"><a href="part1.html#cb14-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">&quot;Undefined event type: &#39;&quot;</span>, <span class="fu">current</span>(sim)[<span class="dv">1</span>, <span class="st">&quot;eventType&quot;</span>, <span class="at">with =</span> <span class="cn">FALSE</span>],</span>
<span id="cb14-33"><a href="part1.html#cb14-33" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;&#39; in module &#39;&quot;</span>, <span class="fu">current</span>(sim)[<span class="dv">1</span>, <span class="st">&quot;moduleName&quot;</span>, <span class="at">with =</span> <span class="cn">FALSE</span>], <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb14-34"><a href="part1.html#cb14-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-35"><a href="part1.html#cb14-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">invisible</span>(sim))</span>
<span id="cb14-36"><a href="part1.html#cb14-36" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>We suggest having a look at <code>?base::switch</code> too fully understand its behaviour.
In short, <code>base::switch</code> tells R to execute (or switch) different code depending on the value of <code>EXPR</code> (here <code>eventType</code>).
Here, this means that the behaviour of the function <code>doEvent.speciesAbundance</code> will change depending on the present <code>eventType</code>.
So we need to define what behaviour it should have for each event type defined in the module - namely, which functions will be executed and whether to schedule future events with <code>scheduleEvent</code>.</p>
<div id="init" class="section level5 hasAnchor" number="1.2.2.3.1">
<h5><span class="header-section-number">1.2.2.3.1</span> <strong>init</strong><a href="part1.html#init" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The first event is, obviously, <code>init</code> - again <strong>its name cannot be changed</strong>.</p>
<p>In <code>init</code> we run the initialisation event function (<code>abundanceInit</code>) - optional - and schedule the first occurrence of all other events (here, the abundance simulation, <code>SimulAbund</code>, and plotting, <code>abundPlot</code>, events).
Because the <code>init</code> is the only event that <code>SpaDES</code> always executes at the start of the simulation, if no events are scheduled during <code>init</code>, no events will be executed after the <code>init</code>.
Notice two things:</p>
<ol style="list-style-type: decimal">
<li>The <code>SimulAbund</code> event is scheduled at <code>start(sim)</code> (i.e. at the first time step of the simulation), which means that it will run after the <code>init</code> event, but still in the same “year”.</li>
<li><code>init</code> schedules the first plotting event to be executed at the time defined by the <code>.plotInitialTime</code> parameter, which is stored in the <code>sim</code> object (and obtained using <code>SpaDES.core::P(sim)</code>), but with a slightly lower event priority <code>eventPriority = .normal()+0.5</code> (see <code>?priority</code>).</li>
</ol>
</div>
<div id="simulabund" class="section level5 hasAnchor" number="1.2.2.3.2">
<h5><span class="header-section-number">1.2.2.3.2</span> <strong>SimulAbund</strong><a href="part1.html#simulabund" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The <code>SimulAbund</code> event is defined next.
This event used to be called <code>event1</code> in the template, and we changed its name to be more informative of what it does.
It is the core event of this module, where species abundances are generated via the event function <code>abundanceSim</code>.</p>
<p>The even also <strong>schedules itself</strong> to occur at a frequency defined by the <code>simulationTimeStep</code> parameter</p>
</div>
<div id="abundplot" class="section level5 hasAnchor" number="1.2.2.3.3">
<h5><span class="header-section-number">1.2.2.3.3</span> <strong>abundPlot</strong><a href="part1.html#abundplot" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Finally, we schedule the plotting event, <code>abundPlot</code> (which used to be called <code>plot</code> in the template).
Similarly to the <code>SimulAbund</code> event, it executes an event function (<code>abundancePlot</code>) and reschedules itself.
An important difference is that it uses the <code>.plotInterval</code> parameter, instead of <code>simulationTimeStep</code>, when rescheduling itself.
This way, future events will occur depending on the time step and plot interval parameters defined in the global script (or their default values defined in the metadata section).</p>
</div>
</div>
<div id="inputobjects-function" class="section level4 hasAnchor" number="1.2.2.4">
<h4><span class="header-section-number">1.2.2.4</span> <strong><code>.inputObjects</code> function</strong><a href="part1.html#inputobjects-function" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The end of the template <code>.R</code> script defines a function called <code>.inputObjects</code>.
This is where the developer should include code to provide the defaults for any input objects required by the module.
This is the ideal place to produce the template raster, <code>r</code> , instead of doing so in <code>abundanceInit</code>.
This will allow a future user (or module) to provide their own <code>r</code> object (e.g. for another study area).
If on the other hand we don’t do this and create <code>r</code> during the <code>init</code> event, any <code>r</code> supplied by the user will be overridden by the execution of <code>init</code>.</p>
<p>As a rule of thumb, default inputs should be created in a way that allows their values to be overridden by the user (by supplying a named list of objects via <code>simInit(objects = ...)</code>) or by any other modules that produce these objects.
For this, we rely on the <code>SpaDES.core::suppliedElsewhere</code> function, which detects if a given object has already been supplied by the user or if it will be supplied by another module.</p>
<p>Note that <code>suppliedElsewhere</code> does not know whether the module that supplies the object will be executed <em>before</em> the present module, as it is blind to module scheduling order.
When modules are relatively simple and have an approximately linear flow of interdependencies, <code>SpaDES</code> is usually able to tell the order in which modules need to be executed.
In more complex cases it is a good idea to pass a vector of module names to <code>simInit(loadOrder = ...)</code> definining the order of module execution.</p>
<p>Here’s an example of how to do this (the commented instructions have been deleted):</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="part1.html#cb15-1" aria-hidden="true" tabindex="-1"></a>.inputObjects <span class="ot">&lt;-</span> <span class="cf">function</span>(sim) {</span>
<span id="cb15-2"><a href="part1.html#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">suppliedElsewhere</span>(<span class="st">&quot;r&quot;</span>)) {</span>
<span id="cb15-3"><a href="part1.html#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="do">## make template raster if not supplied elsewhere.</span></span>
<span id="cb15-4"><a href="part1.html#cb15-4" aria-hidden="true" tabindex="-1"></a>    sim<span class="sc">$</span>r <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="at">nrows =</span> <span class="dv">100</span>, <span class="at">ncols =</span> <span class="dv">100</span>, <span class="at">xmn =</span> <span class="sc">-</span><span class="dv">50</span>, <span class="at">xmx =</span> <span class="dv">50</span>, <span class="at">ymn =</span> <span class="sc">-</span><span class="dv">50</span>, <span class="at">ymx =</span> <span class="dv">50</span>)</span>
<span id="cb15-5"><a href="part1.html#cb15-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-6"><a href="part1.html#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">invisible</span>(sim))</span>
<span id="cb15-7"><a href="part1.html#cb15-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>If we choose to supply the default <code>r</code> in <code>.inputObjects</code>, then we need to remove its creation from the <code>abundanceInit</code> function and add <code>r</code> to the metadata as an input.
We have done this, so that <code>abundanceInit</code> only creates a storage list for the outputs:</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="part1.html#cb16-1" aria-hidden="true" tabindex="-1"></a>abundanceInit <span class="ot">&lt;-</span> <span class="cf">function</span>(sim) {</span>
<span id="cb16-2"><a href="part1.html#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">## create storage list of species abundance</span></span>
<span id="cb16-3"><a href="part1.html#cb16-3" aria-hidden="true" tabindex="-1"></a>  sim<span class="sc">$</span>abundRasters <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb16-4"><a href="part1.html#cb16-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5"><a href="part1.html#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">invisible</span>(sim))</span>
<span id="cb16-6"><a href="part1.html#cb16-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>It is good practice to provide default input objects to all remaining modules, so that they can work stand-alone.
We have done this below.</p>
<p><strong>/!\ ATTENTION /!\</strong></p>
<p><em>If <code>r</code> becomes an input with defaults it must be <strong>added to the module metadata</strong> inside an <code>expectsInput</code> call.</em></p>
</div>
<div id="additional-module-functions" class="section level4 hasAnchor" number="1.2.2.5">
<h4><span class="header-section-number">1.2.2.5</span> <strong>Additional module functions</strong><a href="part1.html#additional-module-functions" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Events can also rely on other functions that can either be sourced from other scripts, or defined at the end of the module script (e.g. usually before <code>.inputObjects</code>, although the order is irrelevant).
This is the case for the species abundances generator function, which we coded in a separate script called <code>abundance_model.R</code>.
Scripts with accessory functions like these go into module’s <code>R/</code> folder.</p>
<p>Functions should also be accompanied by metadata.
Here we provide a description of the function, its parameters, returning value and what other package functions it relies on using the <code>roxygen2</code> documentation style (indicated by <code>#'</code>).</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="part1.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Accessory function to speciesAbundance module</span></span>
<span id="cb17-2"><a href="part1.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb17-3"><a href="part1.html#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param ras a raster layer used as template.</span></span>
<span id="cb17-4"><a href="part1.html#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return a fake abundance raster generated as a Gaussian map with scale = 100 and variance = 0.01</span></span>
<span id="cb17-5"><a href="part1.html#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @import NLMR nlm_mpd</span></span>
<span id="cb17-6"><a href="part1.html#cb17-6" aria-hidden="true" tabindex="-1"></a>abundance_model <span class="ot">&lt;-</span> <span class="cf">function</span>(ras) {</span>
<span id="cb17-7"><a href="part1.html#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># abund_ras &lt;- gaussMap(ras, scale = 100, var = 0.01) ## RandomFields no longer available</span></span>
<span id="cb17-8"><a href="part1.html#cb17-8" aria-hidden="true" tabindex="-1"></a>  abund_ras <span class="ot">&lt;-</span> NLMR<span class="sc">::</span><span class="fu">nlm_mpd</span>(</span>
<span id="cb17-9"><a href="part1.html#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncol =</span> <span class="fu">ncol</span>(ras),</span>
<span id="cb17-10"><a href="part1.html#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="fu">nrow</span>(ras),</span>
<span id="cb17-11"><a href="part1.html#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">resolution =</span> <span class="fu">unique</span>(<span class="fu">res</span>(ras)),</span>
<span id="cb17-12"><a href="part1.html#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">roughness =</span> <span class="fl">0.5</span>,</span>
<span id="cb17-13"><a href="part1.html#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">rand_dev =</span> <span class="dv">100</span>,</span>
<span id="cb17-14"><a href="part1.html#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">rescale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb17-15"><a href="part1.html#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb17-16"><a href="part1.html#cb17-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-17"><a href="part1.html#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(abund_ras)</span>
<span id="cb17-18"><a href="part1.html#cb17-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
<hr />
</div>
</div>
<div id="creating-and-adding-additional-modules-the-temperature-module" class="section level3 hasAnchor" number="1.2.3">
<h3><span class="header-section-number">1.2.3</span> Creating and adding additional modules: the <em>temperature</em> module<a href="part1.html#creating-and-adding-additional-modules-the-temperature-module" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The order in which modules are first executed (i.e. their <code>init</code> events) can be automatically determined by inter-module dependencies (i.e. module inputs that are the outputs of other modules).
If there are no inter-module dependencies this order is determined by the order in which the modules are listed in the <code>Part1_DummyModel.R</code> script, or via the <code>simInit(loadOrder = ...)</code> argument.</p>
<p>After the <code>init</code> event, the module execution order follows the order of events.
This means that a module’s events can be scheduled before and after another module’s events within the same simulation time step.
However, keep in mind that this can make the simulation flow hard to follow, debug and change when additional modules are added.</p>
<p>The second module we created generates yearly temperatures.
Apart from different objects and functions names, this module also has the template raster <code>r</code> as required input object.
Recall that <code>r</code> is created during the <code>.inputObjects</code> of the <em>speciesAbundance</em> module.
When the two modules are linked, this object will not be created twice because <code>suppliedElsewhere("r")</code> will tell the <em>temperature</em> module that `r` will be supplied by another module.
This may appear trivial in this example, but it can be extremely useful when inuts are heavy objects that require lengthy computations to be produces.</p>
<p>This is how we set up the <code>temperature.R</code> script looks like:</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="part1.html#cb18-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-2"><a href="part1.html#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Everything in this file gets sourced during simInit, and all functions and objects</span></span>
<span id="cb18-3"><a href="part1.html#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># are put into the simList.</span></span>
<span id="cb18-4"><a href="part1.html#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">defineModule</span>(sim, <span class="fu">list</span>(</span>
<span id="cb18-5"><a href="part1.html#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">&quot;temperature&quot;</span>,</span>
<span id="cb18-6"><a href="part1.html#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">description =</span> <span class="st">&quot;Temperature simulator&quot;</span>,</span>
<span id="cb18-7"><a href="part1.html#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">keywords =</span> <span class="fu">c</span>(<span class="st">&quot;temperature&quot;</span>, <span class="st">&quot;gaussian&quot;</span>, <span class="st">&quot;spatial&quot;</span>),</span>
<span id="cb18-8"><a href="part1.html#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">authors =</span> <span class="fu">structure</span>(<span class="fu">list</span>(<span class="fu">list</span>(<span class="at">given =</span> <span class="fu">c</span>(<span class="st">&quot;Ceres&quot;</span>), <span class="at">family =</span> <span class="st">&quot;Barros&quot;</span>, </span>
<span id="cb18-9"><a href="part1.html#cb18-9" aria-hidden="true" tabindex="-1"></a>                                <span class="at">role =</span> <span class="fu">c</span>(<span class="st">&quot;aut&quot;</span>, <span class="st">&quot;cre&quot;</span>), <span class="at">email =</span> <span class="st">&quot;ceres.barros@ubc.ca&quot;</span>, <span class="at">comment =</span> <span class="cn">NULL</span>)), <span class="at">class =</span> <span class="st">&quot;person&quot;</span>),</span>
<span id="cb18-10"><a href="part1.html#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">childModules =</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb18-11"><a href="part1.html#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">version =</span> <span class="fu">list</span>(<span class="at">temperature =</span> <span class="st">&quot;1.0.0&quot;</span>),</span>
<span id="cb18-12"><a href="part1.html#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">timeframe =</span> <span class="fu">as.POSIXlt</span>(<span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>)),</span>
<span id="cb18-13"><a href="part1.html#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">timeunit =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb18-14"><a href="part1.html#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">citation =</span> <span class="fu">list</span>(<span class="st">&quot;citation.bib&quot;</span>),</span>
<span id="cb18-15"><a href="part1.html#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">documentation =</span> <span class="fu">list</span>(<span class="st">&quot;README.txt&quot;</span>, <span class="st">&quot;temperature.Rmd&quot;</span>),</span>
<span id="cb18-16"><a href="part1.html#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">reqdPkgs =</span> <span class="fu">list</span>(<span class="st">&quot;SpaDES.core (&gt;=2.0.2)&quot;</span>,</span>
<span id="cb18-17"><a href="part1.html#cb18-17" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;raster&quot;</span>, <span class="st">&quot;achubaty/NLMR&quot;</span>),</span>
<span id="cb18-18"><a href="part1.html#cb18-18" aria-hidden="true" tabindex="-1"></a>   <span class="at">parameters =</span> <span class="fu">bindrows</span>(</span>
<span id="cb18-19"><a href="part1.html#cb18-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">#defineParameter(&quot;paramName&quot;, &quot;paramClass&quot;, value, min, max, &quot;parameter description&quot;),</span></span>
<span id="cb18-20"><a href="part1.html#cb18-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">defineParameter</span>(<span class="st">&quot;simulationTimeStep&quot;</span>, <span class="st">&quot;numeric&quot;</span>, <span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, </span>
<span id="cb18-21"><a href="part1.html#cb18-21" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;This describes the simulation time step interval&quot;</span>),</span>
<span id="cb18-22"><a href="part1.html#cb18-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">defineParameter</span>(<span class="st">&quot;.plotInitialTime&quot;</span>, <span class="st">&quot;numeric&quot;</span>, <span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, </span>
<span id="cb18-23"><a href="part1.html#cb18-23" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;This describes the simulation time at which the first plot event should occur&quot;</span>),</span>
<span id="cb18-24"><a href="part1.html#cb18-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">defineParameter</span>(<span class="st">&quot;.plotInterval&quot;</span>, <span class="st">&quot;numeric&quot;</span>, <span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>,</span>
<span id="cb18-25"><a href="part1.html#cb18-25" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;This describes the simulation time interval between plot events&quot;</span>)</span>
<span id="cb18-26"><a href="part1.html#cb18-26" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb18-27"><a href="part1.html#cb18-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">inputObjects =</span> <span class="fu">bindrows</span>(</span>
<span id="cb18-28"><a href="part1.html#cb18-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">#expectsInput(&quot;objectName&quot;, &quot;objectClass&quot;, &quot;input object description&quot;, sourceURL, ...),</span></span>
<span id="cb18-29"><a href="part1.html#cb18-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expectsInput</span>(<span class="st">&quot;r&quot;</span>, <span class="st">&quot;RasterLayer&quot;</span>, <span class="st">&quot;Template raster&quot;</span>)</span>
<span id="cb18-30"><a href="part1.html#cb18-30" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb18-31"><a href="part1.html#cb18-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">outputObjects =</span> <span class="fu">bindrows</span>(</span>
<span id="cb18-32"><a href="part1.html#cb18-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">#createsOutput(&quot;objectName&quot;, &quot;objectClass&quot;, &quot;output object description&quot;, ...),</span></span>
<span id="cb18-33"><a href="part1.html#cb18-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">createsOutput</span>(<span class="st">&quot;tempRasters&quot;</span>,  <span class="st">&quot;list&quot;</span>, <span class="st">&quot;List of raster layers of temperature at any given year&quot;</span>)</span>
<span id="cb18-34"><a href="part1.html#cb18-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-35"><a href="part1.html#cb18-35" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb18-36"><a href="part1.html#cb18-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-37"><a href="part1.html#cb18-37" aria-hidden="true" tabindex="-1"></a><span class="do">## event types</span></span>
<span id="cb18-38"><a href="part1.html#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   - type `init` is required for initialiazation</span></span>
<span id="cb18-39"><a href="part1.html#cb18-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-40"><a href="part1.html#cb18-40" aria-hidden="true" tabindex="-1"></a>doEvent.temperature <span class="ot">=</span> <span class="cf">function</span>(sim, eventTime, eventType, <span class="at">debug =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb18-41"><a href="part1.html#cb18-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">switch</span>(</span>
<span id="cb18-42"><a href="part1.html#cb18-42" aria-hidden="true" tabindex="-1"></a>    eventType,</span>
<span id="cb18-43"><a href="part1.html#cb18-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">init =</span> {</span>
<span id="cb18-44"><a href="part1.html#cb18-44" aria-hidden="true" tabindex="-1"></a>      <span class="do">## do stuff for this event</span></span>
<span id="cb18-45"><a href="part1.html#cb18-45" aria-hidden="true" tabindex="-1"></a>      sim <span class="ot">&lt;-</span> <span class="fu">Init</span>(sim)</span>
<span id="cb18-46"><a href="part1.html#cb18-46" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb18-47"><a href="part1.html#cb18-47" aria-hidden="true" tabindex="-1"></a>      <span class="do">## schedule future event(s)</span></span>
<span id="cb18-48"><a href="part1.html#cb18-48" aria-hidden="true" tabindex="-1"></a>      sim <span class="ot">&lt;-</span> <span class="fu">scheduleEvent</span>(sim, <span class="at">eventTime =</span> <span class="fu">start</span>(sim), <span class="at">moduleName =</span> <span class="st">&quot;temperature&quot;</span>, <span class="at">eventType =</span> <span class="st">&quot;SimulTemp&quot;</span>)</span>
<span id="cb18-49"><a href="part1.html#cb18-49" aria-hidden="true" tabindex="-1"></a>      sim <span class="ot">&lt;-</span> <span class="fu">scheduleEvent</span>(sim, <span class="at">eventTime =</span> <span class="fu">P</span>(sim)<span class="sc">$</span>.plotInitialTime, <span class="at">moduleName =</span> <span class="st">&quot;temperature&quot;</span>, </span>
<span id="cb18-50"><a href="part1.html#cb18-50" aria-hidden="true" tabindex="-1"></a>                           <span class="at">eventType =</span> <span class="st">&quot;tempPlot&quot;</span>, <span class="at">eventPriority =</span> <span class="fu">.normal</span>() <span class="sc">+</span> <span class="fl">0.5</span>)</span>
<span id="cb18-51"><a href="part1.html#cb18-51" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb18-52"><a href="part1.html#cb18-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">SimulTemp =</span> {</span>
<span id="cb18-53"><a href="part1.html#cb18-53" aria-hidden="true" tabindex="-1"></a>      <span class="do">## do stuff for this event</span></span>
<span id="cb18-54"><a href="part1.html#cb18-54" aria-hidden="true" tabindex="-1"></a>      sim <span class="ot">&lt;-</span> <span class="fu">update</span>(sim)</span>
<span id="cb18-55"><a href="part1.html#cb18-55" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb18-56"><a href="part1.html#cb18-56" aria-hidden="true" tabindex="-1"></a>      <span class="do">## schedule future event(s)</span></span>
<span id="cb18-57"><a href="part1.html#cb18-57" aria-hidden="true" tabindex="-1"></a>      sim <span class="ot">&lt;-</span> <span class="fu">scheduleEvent</span>(sim, <span class="at">eventTime =</span> <span class="fu">time</span>(sim) <span class="sc">+</span> <span class="fu">P</span>(sim)<span class="sc">$</span>simulationTimeStep, <span class="at">moduleName =</span> <span class="st">&quot;temperature&quot;</span>, </span>
<span id="cb18-58"><a href="part1.html#cb18-58" aria-hidden="true" tabindex="-1"></a>                           <span class="at">eventType =</span> <span class="st">&quot;SimulTemp&quot;</span>)</span>
<span id="cb18-59"><a href="part1.html#cb18-59" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb18-60"><a href="part1.html#cb18-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">tempPlot =</span> {</span>
<span id="cb18-61"><a href="part1.html#cb18-61" aria-hidden="true" tabindex="-1"></a>      <span class="do">## do stuff for this event</span></span>
<span id="cb18-62"><a href="part1.html#cb18-62" aria-hidden="true" tabindex="-1"></a>      sim <span class="ot">&lt;-</span> <span class="fu">plotting</span>(sim)</span>
<span id="cb18-63"><a href="part1.html#cb18-63" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb18-64"><a href="part1.html#cb18-64" aria-hidden="true" tabindex="-1"></a>      <span class="do">## schedule future event(s)</span></span>
<span id="cb18-65"><a href="part1.html#cb18-65" aria-hidden="true" tabindex="-1"></a>      sim <span class="ot">&lt;-</span> <span class="fu">scheduleEvent</span>(sim, <span class="at">eventTime =</span> <span class="fu">time</span>(sim) <span class="sc">+</span> <span class="fu">P</span>(sim)<span class="sc">$</span>.plotInterval, <span class="at">moduleName =</span> <span class="st">&quot;temperature&quot;</span>, </span>
<span id="cb18-66"><a href="part1.html#cb18-66" aria-hidden="true" tabindex="-1"></a>                           <span class="at">eventType =</span> <span class="st">&quot;tempPlot&quot;</span>, <span class="at">eventPriority =</span> <span class="fu">.normal</span>() <span class="sc">+</span> <span class="fl">0.5</span>)</span>
<span id="cb18-67"><a href="part1.html#cb18-67" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb18-68"><a href="part1.html#cb18-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">&quot;Undefined event type: &#39;&quot;</span>, <span class="fu">current</span>(sim)[<span class="dv">1</span>, <span class="st">&quot;eventType&quot;</span>, <span class="at">with =</span> <span class="cn">FALSE</span>],</span>
<span id="cb18-69"><a href="part1.html#cb18-69" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;&#39; in module &#39;&quot;</span>, <span class="fu">current</span>(sim)[<span class="dv">1</span>, <span class="st">&quot;moduleName&quot;</span>, <span class="at">with =</span> <span class="cn">FALSE</span>], <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb18-70"><a href="part1.html#cb18-70" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-71"><a href="part1.html#cb18-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">invisible</span>(sim))</span>
<span id="cb18-72"><a href="part1.html#cb18-72" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-73"><a href="part1.html#cb18-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-74"><a href="part1.html#cb18-74" aria-hidden="true" tabindex="-1"></a><span class="do">## This is the &#39;init&#39; event:</span></span>
<span id="cb18-75"><a href="part1.html#cb18-75" aria-hidden="true" tabindex="-1"></a>Init <span class="ot">&lt;-</span> <span class="cf">function</span>(sim) {</span>
<span id="cb18-76"><a href="part1.html#cb18-76" aria-hidden="true" tabindex="-1"></a>  <span class="do">## create storage list of species temperature</span></span>
<span id="cb18-77"><a href="part1.html#cb18-77" aria-hidden="true" tabindex="-1"></a>  sim<span class="sc">$</span>tempRasters <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb18-78"><a href="part1.html#cb18-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-79"><a href="part1.html#cb18-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">invisible</span>(sim))</span>
<span id="cb18-80"><a href="part1.html#cb18-80" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-81"><a href="part1.html#cb18-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-82"><a href="part1.html#cb18-82" aria-hidden="true" tabindex="-1"></a><span class="do">## This is the temperature simulation event function</span></span>
<span id="cb18-83"><a href="part1.html#cb18-83" aria-hidden="true" tabindex="-1"></a>update <span class="ot">&lt;-</span> <span class="cf">function</span>(sim) {</span>
<span id="cb18-84"><a href="part1.html#cb18-84" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Generate temperature - our &quot;updated data&quot;</span></span>
<span id="cb18-85"><a href="part1.html#cb18-85" aria-hidden="true" tabindex="-1"></a>  sim<span class="sc">$</span>tempRasters[[<span class="fu">as.character</span>(<span class="fu">time</span>(sim))]] <span class="ot">&lt;-</span> <span class="fu">temperature_model</span>(<span class="at">ras =</span> sim<span class="sc">$</span>r)</span>
<span id="cb18-86"><a href="part1.html#cb18-86" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-87"><a href="part1.html#cb18-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">invisible</span>(sim))</span>
<span id="cb18-88"><a href="part1.html#cb18-88" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-89"><a href="part1.html#cb18-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-90"><a href="part1.html#cb18-90" aria-hidden="true" tabindex="-1"></a><span class="do">## This is the plotting event funciton</span></span>
<span id="cb18-91"><a href="part1.html#cb18-91" aria-hidden="true" tabindex="-1"></a>plotting <span class="ot">&lt;-</span> <span class="cf">function</span>(sim) {</span>
<span id="cb18-92"><a href="part1.html#cb18-92" aria-hidden="true" tabindex="-1"></a>  <span class="do">## plot temperature</span></span>
<span id="cb18-93"><a href="part1.html#cb18-93" aria-hidden="true" tabindex="-1"></a>  plotTitle <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;Temperature</span><span class="sc">\n</span><span class="st">at time&quot;</span>,</span>
<span id="cb18-94"><a href="part1.html#cb18-94" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">names</span>(sim<span class="sc">$</span>tempRasters)[<span class="fu">length</span>(sim<span class="sc">$</span>tempRasters)])</span>
<span id="cb18-95"><a href="part1.html#cb18-95" aria-hidden="true" tabindex="-1"></a>  tempPlot <span class="ot">&lt;-</span> sim<span class="sc">$</span>tempRasters[[<span class="fu">length</span>(sim<span class="sc">$</span>tempRasters)]] </span>
<span id="cb18-96"><a href="part1.html#cb18-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Plot</span>(tempPlot, </span>
<span id="cb18-97"><a href="part1.html#cb18-97" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> plotTitle, </span>
<span id="cb18-98"><a href="part1.html#cb18-98" aria-hidden="true" tabindex="-1"></a>       <span class="at">new =</span> <span class="cn">TRUE</span>, <span class="at">addTo =</span> <span class="st">&quot;tempPlot&quot;</span>)</span>
<span id="cb18-99"><a href="part1.html#cb18-99" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-100"><a href="part1.html#cb18-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">invisible</span>(sim))</span>
<span id="cb18-101"><a href="part1.html#cb18-101" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-102"><a href="part1.html#cb18-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-103"><a href="part1.html#cb18-103" aria-hidden="true" tabindex="-1"></a>.inputObjects <span class="ot">&lt;-</span> <span class="cf">function</span>(sim) {</span>
<span id="cb18-104"><a href="part1.html#cb18-104" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">suppliedElsewhere</span>(<span class="st">&quot;r&quot;</span>)) {</span>
<span id="cb18-105"><a href="part1.html#cb18-105" aria-hidden="true" tabindex="-1"></a>    <span class="do">## make template raster if not supplied elsewhere.</span></span>
<span id="cb18-106"><a href="part1.html#cb18-106" aria-hidden="true" tabindex="-1"></a>    sim<span class="sc">$</span>r <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="at">nrows =</span> <span class="dv">100</span>, <span class="at">ncols =</span> <span class="dv">100</span>, <span class="at">xmn =</span> <span class="sc">-</span><span class="dv">50</span>, <span class="at">xmx =</span> <span class="dv">50</span>, <span class="at">ymn =</span> <span class="sc">-</span><span class="dv">50</span>, <span class="at">ymx =</span> <span class="dv">50</span>)</span>
<span id="cb18-107"><a href="part1.html#cb18-107" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-108"><a href="part1.html#cb18-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">invisible</span>(sim))</span>
<span id="cb18-109"><a href="part1.html#cb18-109" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>Again, we added an accessory <code>temperature_model</code> function in a separate script <code>R/temperature_model.R</code>:</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="part1.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Accessory function to temperature module</span></span>
<span id="cb19-2"><a href="part1.html#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb19-3"><a href="part1.html#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param ras a raster layer used as template.</span></span>
<span id="cb19-4"><a href="part1.html#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return a fake temperature raster generated as a Gaussian map with scale = 100 and variance = 0.01</span></span>
<span id="cb19-5"><a href="part1.html#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @import NLMR nlm_mpd</span></span>
<span id="cb19-6"><a href="part1.html#cb19-6" aria-hidden="true" tabindex="-1"></a>temperature_model <span class="ot">&lt;-</span> <span class="cf">function</span>(ras) {</span>
<span id="cb19-7"><a href="part1.html#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># temp_ras &lt;- gaussMap(ras, scale = 100, var = 0.01) ## RandomFields no longer available</span></span>
<span id="cb19-8"><a href="part1.html#cb19-8" aria-hidden="true" tabindex="-1"></a>  temp_ras <span class="ot">&lt;-</span> NLMR<span class="sc">::</span><span class="fu">nlm_mpd</span>(</span>
<span id="cb19-9"><a href="part1.html#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncol =</span> <span class="fu">ncol</span>(ras),</span>
<span id="cb19-10"><a href="part1.html#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="fu">nrow</span>(ras),</span>
<span id="cb19-11"><a href="part1.html#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">resolution =</span> <span class="fu">unique</span>(<span class="fu">res</span>(ras)),</span>
<span id="cb19-12"><a href="part1.html#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">roughness =</span> <span class="fl">0.5</span>,</span>
<span id="cb19-13"><a href="part1.html#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">rand_dev =</span> <span class="dv">10</span>,</span>
<span id="cb19-14"><a href="part1.html#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">rescale =</span> <span class="cn">FALSE</span>,</span>
<span id="cb19-15"><a href="part1.html#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb19-16"><a href="part1.html#cb19-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-17"><a href="part1.html#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(temp_ras)</span>
<span id="cb19-18"><a href="part1.html#cb19-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
<hr />
</div>
<div id="modules-that-depend-on-other-modules-the-speciestemplm-module" class="section level3 hasAnchor" number="1.2.4">
<h3><span class="header-section-number">1.2.4</span> Modules that depend on other modules: the <em>speciesTempLM</em> module<a href="part1.html#modules-that-depend-on-other-modules-the-speciestemplm-module" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Our third and last module, <em>speciesTempLM</em>, will be used to run the statistical analysis at each year, after the abundances and temperatures are generated (<strong>species</strong> and <strong>Temp</strong>erature <strong>L</strong>inear <strong>M</strong>odel).
Hence, it will depend on the outputs of the <em>speciesAbundance</em> and the <em>temperature</em> modules.</p>
<p>The interest of keeping the statistical analysis in a separate module lies on the fact that it allows us to easily swap and compare different statistical models to analyse our data if we want to.</p>
<p>It also allows for greater flexibility when it comes to <strong>when</strong> the statistical model is supposed to run.
For example, we may want to fit it at every 5 years, instead of every year, using the previous 5 years of data.
By having the statistical analysis contained in its own module, we don’t need to change other module scripts in order to make these changes.</p>
<p>Finally, we draw your attention to a few differences in this module’s script before we see it:</p>
<ul>
<li><p>The <strong>frequency</strong> of the statistical analysis (and correspondent plots) will be determined by the parameter <code>statsTimestep</code>.
This parameter also determines the number of data years to be used to fit the linear model.
If <code>statsTimestep = 5</code>, the statistical analysis will use the precedent 5 years of data including the year in which the event is running (a total of 6 years of data);</p></li>
<li><p>This module <strong>requires inputs</strong> that have no defaults in <code>.inputObjects</code>.
They are specified in <code>inputObjects</code> part of <code>defineModule</code> - notice how we’ve respected the names, classes and description of the objects that come from the <em>speciesAbundance</em> and the <em>temperature</em> modules;</p></li>
<li><p>We have <strong>two additional functions</strong> in a separate script (<code>R/linear_model_functions.R</code>): the function fitting the linear model and a plotting function.</p></li>
</ul>
<p>Below is the full module script.
Notice how the future events where scheduled to <code>P(sim)$statsTimestep + 0.1</code>, to force the statistical analyses to occur <strong>after</strong> the abundance and temperature rasters are ready.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="part1.html#cb20-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-2"><a href="part1.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Everything in this file gets sourced during simInit, and all functions and objects</span></span>
<span id="cb20-3"><a href="part1.html#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># are put into the simList.</span></span>
<span id="cb20-4"><a href="part1.html#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">defineModule</span>(sim, <span class="fu">list</span>(</span>
<span id="cb20-5"><a href="part1.html#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">&quot;speciesTempLM&quot;</span>,</span>
<span id="cb20-6"><a href="part1.html#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">description =</span> <span class="st">&quot;Statistical analysis of species ~ temperature relationships using LM&quot;</span>,</span>
<span id="cb20-7"><a href="part1.html#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">keywords =</span> <span class="fu">c</span>(<span class="st">&quot;linear model&quot;</span>),</span>
<span id="cb20-8"><a href="part1.html#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">authors =</span> <span class="fu">structure</span>(<span class="fu">list</span>(<span class="fu">list</span>(<span class="at">given =</span> <span class="fu">c</span>(<span class="st">&quot;Ceres&quot;</span>), <span class="at">family =</span> <span class="st">&quot;Barros&quot;</span>, </span>
<span id="cb20-9"><a href="part1.html#cb20-9" aria-hidden="true" tabindex="-1"></a>                                <span class="at">role =</span> <span class="fu">c</span>(<span class="st">&quot;aut&quot;</span>, <span class="st">&quot;cre&quot;</span>), <span class="at">email =</span> <span class="st">&quot;ceres.barros@ubc.ca&quot;</span>, <span class="at">comment =</span> <span class="cn">NULL</span>)), <span class="at">class =</span> <span class="st">&quot;person&quot;</span>),</span>
<span id="cb20-10"><a href="part1.html#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">childModules =</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb20-11"><a href="part1.html#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">version =</span> <span class="fu">list</span>(<span class="at">speciesTempLM =</span> <span class="st">&quot;1.0.0&quot;</span>),</span>
<span id="cb20-12"><a href="part1.html#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">timeframe =</span> <span class="fu">as.POSIXlt</span>(<span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>)),</span>
<span id="cb20-13"><a href="part1.html#cb20-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">timeunit =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb20-14"><a href="part1.html#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">citation =</span> <span class="fu">list</span>(<span class="st">&quot;citation.bib&quot;</span>),</span>
<span id="cb20-15"><a href="part1.html#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">documentation =</span> <span class="fu">list</span>(<span class="st">&quot;README.txt&quot;</span>, <span class="st">&quot;speciesTempLM.Rmd&quot;</span>),</span>
<span id="cb20-16"><a href="part1.html#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">reqdPkgs =</span> <span class="fu">list</span>(<span class="st">&quot;SpaDES.core (&gt;=2.0.2)&quot;</span>,</span>
<span id="cb20-17"><a href="part1.html#cb20-17" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;raster&quot;</span>, <span class="st">&quot;ggplot2&quot;</span>, <span class="st">&quot;data.table&quot;</span>, <span class="st">&quot;reshape2&quot;</span>),</span>
<span id="cb20-18"><a href="part1.html#cb20-18" aria-hidden="true" tabindex="-1"></a>   <span class="at">parameters =</span> <span class="fu">bindrows</span>(</span>
<span id="cb20-19"><a href="part1.html#cb20-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">#defineParameter(&quot;paramName&quot;, &quot;paramClass&quot;, value, min, max, &quot;parameter description&quot;),</span></span>
<span id="cb20-20"><a href="part1.html#cb20-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">defineParameter</span>(<span class="st">&quot;statsTimestep&quot;</span>, <span class="st">&quot;numeric&quot;</span>, <span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">&quot;This describes the how often the statitiscal analysis will be done&quot;</span>)</span>
<span id="cb20-21"><a href="part1.html#cb20-21" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb20-22"><a href="part1.html#cb20-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">inputObjects =</span> <span class="fu">bindrows</span>(</span>
<span id="cb20-23"><a href="part1.html#cb20-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">#expectsInput(&quot;objectName&quot;, &quot;objectClass&quot;, &quot;input object description&quot;, sourceURL, ...),</span></span>
<span id="cb20-24"><a href="part1.html#cb20-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expectsInput</span>(<span class="st">&quot;abundRasters&quot;</span>, <span class="st">&quot;list&quot;</span>, <span class="st">&quot;List of raster layers of species abundance at any given year&quot;</span>),</span>
<span id="cb20-25"><a href="part1.html#cb20-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expectsInput</span>(<span class="st">&quot;tempRasters&quot;</span>, <span class="st">&quot;list&quot;</span>, <span class="st">&quot;List of raster layers of temperature at any given year&quot;</span>)</span>
<span id="cb20-26"><a href="part1.html#cb20-26" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb20-27"><a href="part1.html#cb20-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">outputObjects =</span> <span class="fu">bindrows</span>(</span>
<span id="cb20-28"><a href="part1.html#cb20-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">#createsOutput(&quot;objectName&quot;, &quot;objectClass&quot;, &quot;output object description&quot;, ...),</span></span>
<span id="cb20-29"><a href="part1.html#cb20-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">createsOutput</span>(<span class="st">&quot;outputdata&quot;</span>, <span class="st">&quot;list&quot;</span>, <span class="st">&quot;List of dataframes containing species abundances and temperature values per pixel&quot;</span>),</span>
<span id="cb20-30"><a href="part1.html#cb20-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">createsOutput</span>(<span class="st">&quot;outputLM&quot;</span>, <span class="st">&quot;list&quot;</span>, <span class="st">&quot;List of output yearly LMs (abundance ~ temperature)&quot;</span>),</span>
<span id="cb20-31"><a href="part1.html#cb20-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">createsOutput</span>(<span class="st">&quot;yrs&quot;</span>, <span class="st">&quot;numeric&quot;</span>, <span class="st">&quot;Vector of years used for statistical analysis&quot;</span>)</span>
<span id="cb20-32"><a href="part1.html#cb20-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-33"><a href="part1.html#cb20-33" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb20-34"><a href="part1.html#cb20-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-35"><a href="part1.html#cb20-35" aria-hidden="true" tabindex="-1"></a><span class="do">## event types</span></span>
<span id="cb20-36"><a href="part1.html#cb20-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   - type `init` is required for initialiazation</span></span>
<span id="cb20-37"><a href="part1.html#cb20-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-38"><a href="part1.html#cb20-38" aria-hidden="true" tabindex="-1"></a>doEvent.speciesTempLM <span class="ot">=</span> <span class="cf">function</span>(sim, eventTime, eventType, <span class="at">debug =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb20-39"><a href="part1.html#cb20-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">switch</span>(</span>
<span id="cb20-40"><a href="part1.html#cb20-40" aria-hidden="true" tabindex="-1"></a>    eventType,</span>
<span id="cb20-41"><a href="part1.html#cb20-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">init =</span> {</span>
<span id="cb20-42"><a href="part1.html#cb20-42" aria-hidden="true" tabindex="-1"></a>      <span class="do">## do stuff for this event</span></span>
<span id="cb20-43"><a href="part1.html#cb20-43" aria-hidden="true" tabindex="-1"></a>      sim <span class="ot">&lt;-</span> <span class="fu">statsInit</span>(sim)</span>
<span id="cb20-44"><a href="part1.html#cb20-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-45"><a href="part1.html#cb20-45" aria-hidden="true" tabindex="-1"></a>      <span class="do">## schedule future event(s)</span></span>
<span id="cb20-46"><a href="part1.html#cb20-46" aria-hidden="true" tabindex="-1"></a>      sim <span class="ot">&lt;-</span> <span class="fu">scheduleEvent</span>(sim, <span class="fu">P</span>(sim)<span class="sc">$</span>statsTimestep, <span class="st">&quot;speciesTempLM&quot;</span>, </span>
<span id="cb20-47"><a href="part1.html#cb20-47" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;stats&quot;</span>, <span class="at">eventPriority =</span> <span class="fu">.normal</span>() <span class="sc">+</span> <span class="dv">2</span>)</span>
<span id="cb20-48"><a href="part1.html#cb20-48" aria-hidden="true" tabindex="-1"></a>      sim <span class="ot">&lt;-</span> <span class="fu">scheduleEvent</span>(sim, <span class="fu">P</span>(sim)<span class="sc">$</span>statsTimestep, <span class="st">&quot;speciesTempLM&quot;</span>, </span>
<span id="cb20-49"><a href="part1.html#cb20-49" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;statsPlot&quot;</span>, <span class="at">eventPriority =</span> <span class="fu">.normal</span>() <span class="sc">+</span> <span class="fl">2.5</span>)</span>
<span id="cb20-50"><a href="part1.html#cb20-50" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb20-51"><a href="part1.html#cb20-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">stats =</span> {</span>
<span id="cb20-52"><a href="part1.html#cb20-52" aria-hidden="true" tabindex="-1"></a>      <span class="do">## do stuff for this event</span></span>
<span id="cb20-53"><a href="part1.html#cb20-53" aria-hidden="true" tabindex="-1"></a>      sim <span class="ot">&lt;-</span> <span class="fu">statsAnalysis</span>(sim)</span>
<span id="cb20-54"><a href="part1.html#cb20-54" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb20-55"><a href="part1.html#cb20-55" aria-hidden="true" tabindex="-1"></a>      <span class="do">## schedule future event(s)</span></span>
<span id="cb20-56"><a href="part1.html#cb20-56" aria-hidden="true" tabindex="-1"></a>      sim <span class="ot">&lt;-</span> <span class="fu">scheduleEvent</span>(sim, <span class="fu">time</span>(sim) <span class="sc">+</span> <span class="fu">P</span>(sim)<span class="sc">$</span>statsTimestep, <span class="st">&quot;speciesTempLM&quot;</span>, </span>
<span id="cb20-57"><a href="part1.html#cb20-57" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;stats&quot;</span>, <span class="at">eventPriority =</span> <span class="fu">.normal</span>() <span class="sc">+</span> <span class="dv">2</span>)</span>
<span id="cb20-58"><a href="part1.html#cb20-58" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb20-59"><a href="part1.html#cb20-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">statsPlot =</span> {</span>
<span id="cb20-60"><a href="part1.html#cb20-60" aria-hidden="true" tabindex="-1"></a>      <span class="do">## do stuff for this event</span></span>
<span id="cb20-61"><a href="part1.html#cb20-61" aria-hidden="true" tabindex="-1"></a>      sim <span class="ot">&lt;-</span> <span class="fu">statsPlot</span>(sim)</span>
<span id="cb20-62"><a href="part1.html#cb20-62" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb20-63"><a href="part1.html#cb20-63" aria-hidden="true" tabindex="-1"></a>      <span class="do">## schedule future event(s)</span></span>
<span id="cb20-64"><a href="part1.html#cb20-64" aria-hidden="true" tabindex="-1"></a>      sim <span class="ot">&lt;-</span> <span class="fu">scheduleEvent</span>(sim, <span class="fu">time</span>(sim) <span class="sc">+</span> <span class="fu">P</span>(sim)<span class="sc">$</span>statsTimestep, <span class="st">&quot;speciesTempLM&quot;</span>,</span>
<span id="cb20-65"><a href="part1.html#cb20-65" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;statsPlot&quot;</span>, <span class="at">eventPriority =</span> <span class="fu">.normal</span>() <span class="sc">+</span> <span class="fl">2.5</span>)</span>
<span id="cb20-66"><a href="part1.html#cb20-66" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb20-67"><a href="part1.html#cb20-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">&quot;Undefined event type: &#39;&quot;</span>, <span class="fu">current</span>(sim)[<span class="dv">1</span>, <span class="st">&quot;eventType&quot;</span>, <span class="at">with =</span> <span class="cn">FALSE</span>],</span>
<span id="cb20-68"><a href="part1.html#cb20-68" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;&#39; in module &#39;&quot;</span>, <span class="fu">current</span>(sim)[<span class="dv">1</span>, <span class="st">&quot;moduleName&quot;</span>, <span class="at">with =</span> <span class="cn">FALSE</span>], <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb20-69"><a href="part1.html#cb20-69" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-70"><a href="part1.html#cb20-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">invisible</span>(sim))</span>
<span id="cb20-71"><a href="part1.html#cb20-71" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-72"><a href="part1.html#cb20-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-73"><a href="part1.html#cb20-73" aria-hidden="true" tabindex="-1"></a><span class="do">## template initialization</span></span>
<span id="cb20-74"><a href="part1.html#cb20-74" aria-hidden="true" tabindex="-1"></a>statsInit <span class="ot">&lt;-</span> <span class="cf">function</span>(sim) {</span>
<span id="cb20-75"><a href="part1.html#cb20-75" aria-hidden="true" tabindex="-1"></a>  <span class="do">## create outputs storage lists</span></span>
<span id="cb20-76"><a href="part1.html#cb20-76" aria-hidden="true" tabindex="-1"></a>  sim<span class="sc">$</span>outputLM <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb20-77"><a href="part1.html#cb20-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-78"><a href="part1.html#cb20-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">invisible</span>(sim))</span>
<span id="cb20-79"><a href="part1.html#cb20-79" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-80"><a href="part1.html#cb20-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-81"><a href="part1.html#cb20-81" aria-hidden="true" tabindex="-1"></a><span class="do">## Statistical analysis event</span></span>
<span id="cb20-82"><a href="part1.html#cb20-82" aria-hidden="true" tabindex="-1"></a>statsAnalysis <span class="ot">&lt;-</span> <span class="cf">function</span>(sim) {</span>
<span id="cb20-83"><a href="part1.html#cb20-83" aria-hidden="true" tabindex="-1"></a>  <span class="do">## get all species abundances data available</span></span>
<span id="cb20-84"><a href="part1.html#cb20-84" aria-hidden="true" tabindex="-1"></a>  abundData <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="fu">getValues</span>(<span class="fu">stack</span>(sim<span class="sc">$</span>abundRasters)))</span>
<span id="cb20-85"><a href="part1.html#cb20-85" aria-hidden="true" tabindex="-1"></a>  abundData[, pixID <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(abundData)]</span>
<span id="cb20-86"><a href="part1.html#cb20-86" aria-hidden="true" tabindex="-1"></a>  abundData <span class="ot">&lt;-</span> <span class="fu">melt.data.table</span>(abundData, <span class="at">id.var =</span> <span class="st">&quot;pixID&quot;</span>,</span>
<span id="cb20-87"><a href="part1.html#cb20-87" aria-hidden="true" tabindex="-1"></a>                               <span class="at">variable.name =</span> <span class="st">&quot;year&quot;</span>, <span class="at">value.name =</span> <span class="st">&quot;abund&quot;</span>)</span>
<span id="cb20-88"><a href="part1.html#cb20-88" aria-hidden="true" tabindex="-1"></a>  abundData[, year <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(<span class="fu">sub</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;&quot;</span>, year))]</span>
<span id="cb20-89"><a href="part1.html#cb20-89" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-90"><a href="part1.html#cb20-90" aria-hidden="true" tabindex="-1"></a>  <span class="do">## get all temperature data available</span></span>
<span id="cb20-91"><a href="part1.html#cb20-91" aria-hidden="true" tabindex="-1"></a>  tempData <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="fu">getValues</span>(<span class="fu">stack</span>(sim<span class="sc">$</span>tempRasters)))</span>
<span id="cb20-92"><a href="part1.html#cb20-92" aria-hidden="true" tabindex="-1"></a>  tempData[, pixID <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(tempData)]</span>
<span id="cb20-93"><a href="part1.html#cb20-93" aria-hidden="true" tabindex="-1"></a>  tempData <span class="ot">&lt;-</span> <span class="fu">melt.data.table</span>(tempData, <span class="at">id.var =</span> <span class="st">&quot;pixID&quot;</span>,</span>
<span id="cb20-94"><a href="part1.html#cb20-94" aria-hidden="true" tabindex="-1"></a>                              <span class="at">variable.name =</span> <span class="st">&quot;year&quot;</span>, <span class="at">value.name =</span> <span class="st">&quot;temp&quot;</span>)</span>
<span id="cb20-95"><a href="part1.html#cb20-95" aria-hidden="true" tabindex="-1"></a>  tempData[, year <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(<span class="fu">sub</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;&quot;</span>, year))] </span>
<span id="cb20-96"><a href="part1.html#cb20-96" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-97"><a href="part1.html#cb20-97" aria-hidden="true" tabindex="-1"></a>  <span class="do">## merge per year  </span></span>
<span id="cb20-98"><a href="part1.html#cb20-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setkey</span>(abundData, pixID, year)</span>
<span id="cb20-99"><a href="part1.html#cb20-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setkey</span>(tempData, pixID, year)</span>
<span id="cb20-100"><a href="part1.html#cb20-100" aria-hidden="true" tabindex="-1"></a>  sim<span class="sc">$</span>outputdata <span class="ot">&lt;-</span> abundData[tempData]</span>
<span id="cb20-101"><a href="part1.html#cb20-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-102"><a href="part1.html#cb20-102" aria-hidden="true" tabindex="-1"></a>  sim<span class="sc">$</span>outputLM[[<span class="fu">as.character</span>(<span class="fu">time</span>(sim))]] <span class="ot">&lt;-</span> <span class="fu">linearModel</span>(<span class="at">Data =</span> sim<span class="sc">$</span>outputdata)</span>
<span id="cb20-103"><a href="part1.html#cb20-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">invisible</span>(sim))</span>
<span id="cb20-104"><a href="part1.html#cb20-104" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-105"><a href="part1.html#cb20-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-106"><a href="part1.html#cb20-106" aria-hidden="true" tabindex="-1"></a><span class="do">## Plotting event</span></span>
<span id="cb20-107"><a href="part1.html#cb20-107" aria-hidden="true" tabindex="-1"></a>statsPlot <span class="ot">&lt;-</span> <span class="cf">function</span>(sim) {</span>
<span id="cb20-108"><a href="part1.html#cb20-108" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> sim<span class="sc">$</span>outputLM[[<span class="fu">as.character</span>(<span class="fu">time</span>(sim))]]</span>
<span id="cb20-109"><a href="part1.html#cb20-109" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-110"><a href="part1.html#cb20-110" aria-hidden="true" tabindex="-1"></a>  modelPlot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sim<span class="sc">$</span>outputdata) <span class="sc">+</span> </span>
<span id="cb20-111"><a href="part1.html#cb20-111" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> temp, <span class="at">y =</span> abund)) <span class="sc">+</span></span>
<span id="cb20-112"><a href="part1.html#cb20-112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">intercept =</span> model<span class="sc">$</span>coefficients[<span class="st">&quot;(Intercept)&quot;</span>], </span>
<span id="cb20-113"><a href="part1.html#cb20-113" aria-hidden="true" tabindex="-1"></a>                <span class="at">slope =</span> model<span class="sc">$</span>coefficients[<span class="st">&quot;temp&quot;</span>], <span class="at">size =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb20-114"><a href="part1.html#cb20-114" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb20-115"><a href="part1.html#cb20-115" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Temp.&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Species abundance&quot;</span>)</span>
<span id="cb20-116"><a href="part1.html#cb20-116" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-117"><a href="part1.html#cb20-117" aria-hidden="true" tabindex="-1"></a>  plotTitle <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;abundance ~ temperature</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb20-118"><a href="part1.html#cb20-118" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;years&quot;</span>, <span class="fu">range</span>(sim<span class="sc">$</span>outputdata<span class="sc">$</span>year)[<span class="dv">1</span>],</span>
<span id="cb20-119"><a href="part1.html#cb20-119" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;to&quot;</span>, <span class="fu">range</span>(sim<span class="sc">$</span>outputdata<span class="sc">$</span>year)[<span class="dv">2</span>])</span>
<span id="cb20-120"><a href="part1.html#cb20-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Plot</span>(modelPlot, </span>
<span id="cb20-121"><a href="part1.html#cb20-121" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> plotTitle, </span>
<span id="cb20-122"><a href="part1.html#cb20-122" aria-hidden="true" tabindex="-1"></a>       <span class="at">new =</span> <span class="cn">TRUE</span>, <span class="at">addTo =</span> <span class="st">&quot;modelPlot&quot;</span>)</span>
<span id="cb20-123"><a href="part1.html#cb20-123" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-124"><a href="part1.html#cb20-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">invisible</span>(sim))</span>
<span id="cb20-125"><a href="part1.html#cb20-125" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-126"><a href="part1.html#cb20-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-127"><a href="part1.html#cb20-127" aria-hidden="true" tabindex="-1"></a>.inputObjects <span class="ot">&lt;-</span> <span class="cf">function</span>(sim) {</span>
<span id="cb20-128"><a href="part1.html#cb20-128" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Any code written here will be run during the simInit for the purpose of creating</span></span>
<span id="cb20-129"><a href="part1.html#cb20-129" aria-hidden="true" tabindex="-1"></a>  <span class="co"># any objects required by this module and identified in the inputObjects element of defineModule.</span></span>
<span id="cb20-130"><a href="part1.html#cb20-130" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This is useful if there is something required before simulation to produce the module</span></span>
<span id="cb20-131"><a href="part1.html#cb20-131" aria-hidden="true" tabindex="-1"></a>  <span class="co"># object dependencies, including such things as downloading default datasets, e.g.,</span></span>
<span id="cb20-132"><a href="part1.html#cb20-132" aria-hidden="true" tabindex="-1"></a>  <span class="co"># downloadData(&quot;LCC2005&quot;, modulePath(sim)).</span></span>
<span id="cb20-133"><a href="part1.html#cb20-133" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Nothing should be created here that does not create a named object in inputObjects.</span></span>
<span id="cb20-134"><a href="part1.html#cb20-134" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Any other initiation procedures should be put in &quot;init&quot; eventType of the doEvent function.</span></span>
<span id="cb20-135"><a href="part1.html#cb20-135" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Note: the module developer can check if an object is &#39;suppliedElsewhere&#39; to</span></span>
<span id="cb20-136"><a href="part1.html#cb20-136" aria-hidden="true" tabindex="-1"></a>  <span class="co"># selectively skip unnecessary steps because the user has provided those inputObjects in the</span></span>
<span id="cb20-137"><a href="part1.html#cb20-137" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simInit call, or another module will supply or has supplied it. e.g.,</span></span>
<span id="cb20-138"><a href="part1.html#cb20-138" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if (!suppliedElsewhere(&#39;defaultColor&#39;, sim)) {</span></span>
<span id="cb20-139"><a href="part1.html#cb20-139" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   sim$map &lt;- Cache(prepInputs, extractURL(&#39;map&#39;)) # download, extract, load file from url in sourceURL</span></span>
<span id="cb20-140"><a href="part1.html#cb20-140" aria-hidden="true" tabindex="-1"></a>  <span class="co"># }</span></span>
<span id="cb20-141"><a href="part1.html#cb20-141" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-142"><a href="part1.html#cb20-142" aria-hidden="true" tabindex="-1"></a>  <span class="co">#cacheTags &lt;- c(currentModule(sim), &quot;function:.inputObjects&quot;) ## uncomment this if Cache is being used</span></span>
<span id="cb20-143"><a href="part1.html#cb20-143" aria-hidden="true" tabindex="-1"></a>  dPath <span class="ot">&lt;-</span> <span class="fu">asPath</span>(<span class="fu">getOption</span>(<span class="st">&quot;reproducible.destinationPath&quot;</span>, <span class="fu">dataPath</span>(sim)), <span class="dv">1</span>)</span>
<span id="cb20-144"><a href="part1.html#cb20-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">currentModule</span>(sim), <span class="st">&quot;: using dataPath &#39;&quot;</span>, dPath, <span class="st">&quot;&#39;.&quot;</span>)</span>
<span id="cb20-145"><a href="part1.html#cb20-145" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-146"><a href="part1.html#cb20-146" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ! ----- EDIT BELOW ----- ! #</span></span>
<span id="cb20-147"><a href="part1.html#cb20-147" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-148"><a href="part1.html#cb20-148" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ! ----- STOP EDITING ----- ! #</span></span>
<span id="cb20-149"><a href="part1.html#cb20-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">invisible</span>(sim))</span>
<span id="cb20-150"><a href="part1.html#cb20-150" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
<p>And the script with the accessory functions:</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="part1.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Accessory functions to speciesTempLM module</span></span>
<span id="cb21-2"><a href="part1.html#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="part1.html#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Accessory function to speciesTempLM module that calculates a</span></span>
<span id="cb21-4"><a href="part1.html#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  linear regression between species abundances and temperature</span></span>
<span id="cb21-5"><a href="part1.html#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb21-6"><a href="part1.html#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param Data a data.frame or data.table that contains an \code{abund}</span></span>
<span id="cb21-7"><a href="part1.html#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   column and a \code{temp} column with abundance and temperature values </span></span>
<span id="cb21-8"><a href="part1.html#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   in each location, respectively.</span></span>
<span id="cb21-9"><a href="part1.html#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return a linear model (\code{lm}) object fitted with the formula:</span></span>
<span id="cb21-10"><a href="part1.html#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  \code{abund ~ temp}</span></span>
<span id="cb21-11"><a href="part1.html#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="part1.html#cb21-12" aria-hidden="true" tabindex="-1"></a>linearModel <span class="ot">&lt;-</span> <span class="cf">function</span>(Data){</span>
<span id="cb21-13"><a href="part1.html#cb21-13" aria-hidden="true" tabindex="-1"></a>  lm1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(abund <span class="sc">~</span> temp, <span class="at">data =</span> Data)</span>
<span id="cb21-14"><a href="part1.html#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(lm1)</span>
<span id="cb21-15"><a href="part1.html#cb21-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
<hr />
</div>
<div id="simulation" class="section level3 hasAnchor" number="1.2.5">
<h3><span class="header-section-number">1.2.5</span> Simulation<a href="part1.html#simulation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="simulation-setup-in-a-global-script" class="section level4 hasAnchor" number="1.2.5.1">
<h4><span class="header-section-number">1.2.5.1</span> Simulation setup in a “global” script<a href="part1.html#simulation-setup-in-a-global-script" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We can now go back to our <code>Part1_DummyModel.R</code> script and set the simulation up.</p>
<p>The function <code>simInit</code> needs a few arguments listing simulation folder directories, parameters, simulation times, modules and, optionally, input objects supplied by the user.
<code>simInit</code> will prepare a simulation object that can later be run by the <code>spades</code> function:</p>
<ul>
<li><p>The first list, <code>modules</code>, contains modules we want to activate.</p></li>
<li><p><code>times</code> is a named list containing the start and end times of the simulation and what time units we’re working with (with “start” and “end” being the list <code>names</code>. It thus defines the length of the simulation. It is important that the start and ending times are defined in decimals, because <code>SpaDES</code> allows decomposing time units into smaller fractions.</p></li>
<li><p><code>parameters</code> is a named list of named lists, containing parameters values passed to each module.
Note that because the module metadata will (or should) contain default parameter values, here we pass only parameters which we want to change with respect to their defaults.
For instance, <code>.plotInterval</code> is used and defined in the <em>speciesAbundance</em> and <em>temperature</em> modules, but not passed to the <code>simInit</code> function because we want to use the default value.
As a developer providing a reproducible example, we may also chose to list important and useful parameters, even if the value is the same as the default.
Here we chose to list <code>.plotInitialTime</code> (a parameter used and defined in the <em>speciesAbundance</em> and <em>temperature</em> modules), but provide the default value (we experimenting with it by changing its value in the <code>Part1_DummyModel.R</code>).</p></li>
<li><p><code>paths</code> contains the folder directory paths that we set earlier.</p></li>
</ul>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="part1.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="do">## list the modules to use</span></span>
<span id="cb22-2"><a href="part1.html#cb22-2" aria-hidden="true" tabindex="-1"></a>simModules <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;speciesAbundance&quot;</span>, <span class="st">&quot;temperature&quot;</span>, <span class="st">&quot;speciesTempLM&quot;</span>)</span>
<span id="cb22-3"><a href="part1.html#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="part1.html#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Set simulation and module parameters</span></span>
<span id="cb22-5"><a href="part1.html#cb22-5" aria-hidden="true" tabindex="-1"></a>simTimes <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="dv">10</span>, <span class="at">timeunit =</span> <span class="st">&quot;year&quot;</span>)</span>
<span id="cb22-6"><a href="part1.html#cb22-6" aria-hidden="true" tabindex="-1"></a>simParams <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb22-7"><a href="part1.html#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">speciesAbundance =</span> <span class="fu">list</span>(<span class="at">simulationTimeStep =</span> <span class="dv">1</span>, </span>
<span id="cb22-8"><a href="part1.html#cb22-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">.plotInitialTime =</span> <span class="dv">1</span>),</span>
<span id="cb22-9"><a href="part1.html#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">temperature =</span> <span class="fu">list</span>(<span class="at">simulationTimeStep =</span> <span class="dv">1</span>, </span>
<span id="cb22-10"><a href="part1.html#cb22-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">.plotInitialTime =</span> <span class="dv">1</span>),</span>
<span id="cb22-11"><a href="part1.html#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">speciesTempLM =</span> <span class="fu">list</span>(<span class="at">statsTimestep =</span> <span class="dv">5</span>)</span>
<span id="cb22-12"><a href="part1.html#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="part1.html#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="part1.html#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="do">## make a list of directory paths</span></span>
<span id="cb22-15"><a href="part1.html#cb22-15" aria-hidden="true" tabindex="-1"></a>simPaths <span class="ot">&lt;-</span> <span class="fu">getPaths</span>()</span>
<span id="cb22-16"><a href="part1.html#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="part1.html#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Simulation setup</span></span>
<span id="cb22-18"><a href="part1.html#cb22-18" aria-hidden="true" tabindex="-1"></a>mySim <span class="ot">&lt;-</span> <span class="fu">simInit</span>(<span class="at">times =</span> simTimes, <span class="at">params =</span> simParams, </span>
<span id="cb22-19"><a href="part1.html#cb22-19" aria-hidden="true" tabindex="-1"></a>                 <span class="at">modules =</span> simModules, <span class="at">paths =</span> simPaths)</span></code></pre></div>
</details>
<p>Finally, we highlight that <code>simInit</code> also executes all <code>.inputObjects</code> functions, and schedules the <code>init</code> events, but does not execute them:</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="part1.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">events</span>(mySim)</span></code></pre></div>
</details>
</div>
<div id="checking-the-simulation-setup" class="section level4 hasAnchor" number="1.2.5.2">
<h4><span class="header-section-number">1.2.5.2</span> Checking the simulation setup<a href="part1.html#checking-the-simulation-setup" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Before starting the simulations we should check if the modules were linked correctly.</p>
<p><strong>Module diagram</strong></p>
<p><code>moduleDiagram</code> (Fig. <a href="part1.html#fig:moduleDiagram">1.2</a>) is a useful function that shows module inter-dependencies as a network diagram.
The direction of the arrows indicates an output to input flow.
You can see that <em>speciesAbundance</em> and <em>temperature</em> inputs (specifically our `r` raster) are supplied by an external source (<em><em>INPUT</em></em>) - the user or <code>.inputObjects</code>.
Whereas the inputs to the <em>speciesTempLM</em> module are outputs of the <em>speciesAbundance</em> and <em>temperature</em> modules.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="part1.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moduleDiagram</span>(mySim)</span></code></pre></div>
</details>
<div class="figure"><span style="display:block;" id="fig:moduleDiagram"></span>
<img src="Part1_DummyModel_files/figure-html/moduleDiagram-1.png" alt="Diagram of module connections." width="576" />
<p class="caption">
Figure 1.2: Diagram of module connections.
</p>
</div>
<p><strong>Object diagram</strong></p>
<p><code>objectDiagram</code> (Fig. <a href="part1.html#fig:objectDiagram">1.3</a>) provides another way of checking module linkages.
It explicitly shows module inter-dependencies by depicting the objects that establish links between modules.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="part1.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">objectDiagram</span>(mySim)</span></code></pre></div>
</details>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:objectDiagram"></span>
<img src="figures/Part1_objectDiagram.png" alt="Module diagram showing module inter-dependencies with object names."  />
<p class="caption">
Figure 1.3: Module diagram showing module inter-dependencies with object names.
</p>
</div>
</div>
<div id="running-spades" class="section level4 hasAnchor" number="1.2.5.3">
<h4><span class="header-section-number">1.2.5.3</span> Running <code>SpaDES</code><a href="part1.html#running-spades" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We run the simulation using the <code>spades</code> function, which takes the output of the <code>simInit</code>, executes the already scheduled <code>init</code> events, which schedule the remainder of the events.
We passed <code>debug = TRUE</code> so that <code>spades</code> prints the events as they are being executed.
In case something fails, this helps diagnosing where the issue occurred.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="part1.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="do">## run simulation</span></span>
<span id="cb26-2"><a href="part1.html#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dev</span>() <span class="co"># on Windows and Mac, this opens external device if using Rstudio, it is faster</span></span>
<span id="cb26-3"><a href="part1.html#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">clearPlot</span>()</span>
<span id="cb26-4"><a href="part1.html#cb26-4" aria-hidden="true" tabindex="-1"></a>mySim2 <span class="ot">&lt;-</span> <span class="fu">spades</span>(mySim, <span class="at">debug =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</details>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:figSimulationFig"></span>
<img src="figures/simul_plot.png" alt="Simulation plots: Final plot of the simulation" width="80%" />
<p class="caption">
Figure 1.4: Simulation plots: Final plot of the simulation
</p>
</div>
<p>We suggest experimenting with changing parameter values and trying to create and add other modules to further explore all the <code>SpaDES</code> flexibility.
The more complex the project gets, the more advantageous it is to use <code>SpaDES</code> to turn modules <em>on</em> or <em>off</em>, swapping modules to run, e.g., different statistical analyses, or to include different data.</p>
<hr />
</div>
</div>
<div id="additional-notes" class="section level3 hasAnchor" number="1.2.6">
<h3><span class="header-section-number">1.2.6</span> Additional notes<a href="part1.html#additional-notes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>SpaDES</code> is an extremely powerful package, whose potential goes well beyond what has been discussed in this dummy example.
If you want to explore it further, we recommend following Part <a href="part2.html#part2">2</a> for a more realistic (but still simple) <code>SpaDES</code> application.</p>
<p>Also, do go to the <a href="https://spades.predictiveecology.org/"><code>SpaDES</code> webpage</a> to find further information about the platform, as well as upcoming workshops and publications and to the <a href="https://github.com/PredictiveEcology/">Predictive Ecology Github repository</a> to see all the <code>SpaDES</code> modules and SpaDES-related packages that we maintain at the <a href="https://predictiveecology.org">Predictive Ecology Lab</a>.</p>
<hr />
<center>
<p><strong>Happy SpaDESing!</strong></p>
</center>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="part2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SpaDES4Dummies.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"info": false
});
});
</script>

</body>

</html>
